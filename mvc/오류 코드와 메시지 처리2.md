## 오류 코드와 메시지 처리2

오류 코드 관리 전략

<br/>

### 핵심은 구체적인 것에서! 덜 구체적인 것으로!

`MessageCodesResolver` 는 `required.item.itemName` 처럼 구체적인 것을 먼저 만들어주고,

`required` 처럼 덜 구체적인 것을 가장 나중에 만든다.



이렇게 하면 앞서 말한 것 처럼 메시지와 관련된 공통 전략을 편리하게 도입할 수 있다.

<br/>

### 왜 이렇게 복잡하게 사용하는가?

모든 오류 코드에 대해서 메시지를 각각 다 정의하면 개발자 입장에서 관리하기 너무 힘들다.

크게 중요하지 않은 메시지는 범용성 있는 `requried` 같은 메시지로 끝내고, 

정말 중요한 메시지는 꼭 필요할 때 구체적으로 적어서 사용하는 방식이 더 효과적이다.

크게 객체 오류와 필드 오류를 나누었다. 

그리고 범용성에 따라 레벨을 나누어두었다

<br/>

### itemName 의 경우 required 검증 오류 메시지가 발생하면 다음 코드 
순서대로 메시지가 생성된다.

1. required.item.itemName

2. required.itemName
3. required.java.lang.String
4. required

그리고 이렇게 생성된 메시지 코드를 기반으로 순서대로 MessageSource 에서 메시지에서 찾는다.

구체적인 것에서 덜 구체적인 순서대로 찾는다. 

<br/>

메시지에 1번이 없으면 2번을 찾고, 2번이 없으면 3번을 찾는다.

이렇게 되면 만약에 크게 중요하지 않은 오류 메시지는 기존에 정의된 것을 그냥 재활용 하면 된다!

<br/>

## price 필드에 문자 "A"를 입력해보자.

로그를 확인해보면 BindingResult 에 FieldError 가 담겨있고, 다음과 같은 메시지 코드들이 

생성된 것을 확인할 수 있다.

```java
codes[typeMismatch.item.price,typeMismatch.price,typeMismatch.java.lang.Integer,typ
eMismatch]
```

<br/>

다음과 같이 4가지 메시지 코드가 입력되어 있다.

```java
typeMismatch.item.price
typeMismatch.price
typeMismatch.java.lang.Integer
typeMismatch
```

그렇다. 

<br/>

스프링은 타입 오류가 발생하면 typeMismatch 라는 오류 코드를 사용한다. 

이 오류 코드가 MessageCodesResolver 를 통하면서 4가지 메시지 코드가 생성된 것이다.

<br/>

### 실행해보자. 하지만,

아직 errors.properties 에 메시지 코드가 없기 때문에 스프링이 생성한 기본 메시지가 출력된다.

```
Failed to convert property value of type java.lang.String to required type
java.lang.Integer for property price; nested exception is
java.lang.NumberFormatException: For input string: "A"
```

<br/>

`error.properties` 에 다음 내용을 추가하자

```
#추가
typeMismatch.java.lang.Integer=숫자를 입력해주세요.
typeMismatch=타입 오류입니다.
```

다시 실행해보자

결과적으로 소스코드를 하나도 건들지 않고, 원하는 메시지를 단계별로 설정할 수 있다.

<br/>

>**Reference** <br/>스프링 MVC 2편 - 백엔드 웹 개발 활용 기술 - https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-mvc-2