## 회원 가입

Member

```java
package hello.login.domain.member;

import lombok.Data;

import javax.validation.constraints.NotEmpty;

@Data
public class Member {

    private Long id;

    @NotEmpty
    private String loginId; // 로그인 ID

    @NotEmpty
    private String name; // 사용자 이름

    @NotEmpty
    private String password;

}
```

<br/>

MemberRepository

```java
package hello.login.domain.member;

import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Repository;

import java.util.*;

/**
 * 동시성 문제가 고려되어 있지 않음, 실무에서는 ConcurrentHashMap, AtomicLong 사용 고려
 */
@Slf4j
@Repository
public class MemberRepository {
    private static Map<Long, Member> store = new HashMap<>(); //static 사용
    private static long sequence = 0L; //static 사용

    public Member save(Member member) {
        member.setId(++sequence);
        log.info("save: member={}", member);
        store.put(member.getId(), member);
        return member;
    }

    public Member findById(Long id) {
        return store.get(id);
    }

		//스트림 적용하지 않고 자바 코드로 한다면 이렇다.
/*	List<Member> all = findAll();
		for(Member m : all) {
				if(m.getLoginId().equals(loginId)) {
			  	 return Optional.of(m);
				}
		}
		return Optional.empty();
*/	

    // 회원이 있는지 없는지 찾는 로직이다.
    public Optional<Member> findByLoginId(String loginId) {
        return findAll().stream()
                .filter(m -> m.getLoginId().equals(loginId))
                .findFirst();

				// stream().filter() 를 사용하면 괄호안에 만족하는 애만 쓰이는 것이고, 
        // 아닌것은 버려지는 것이다. 즉, 조건에 맞는 애만 다음 단계로 넘어가게 되는 것이다.

        // findFirst() 란? 먼저 나온애를 바로 반환 하는 것이다. 
        // 그리고 뒤에 나온 애들은 무시하는 것이다.

    }

    public List<Member> findAll() {
        return new ArrayList<>(store.values());
    }

    public void clearStore() {
        store.clear();
    }
}
```

<br/>

MemberController

@ModelAttribute("member") 를 @ModelAttribute 로 변경해도 결과는 같다. 

여기서는 IDE에서 인식 문제가 있어서 적용했다.

```java
package hello.login.web.member;

import hello.login.domain.member.Member;
import hello.login.domain.member.MemberRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.validation.BindingResult;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import javax.validation.Valid;

@Controller
@RequiredArgsConstructor
@RequestMapping("/members")
public class MemberController {
    private final MemberRepository memberRepository;

    @GetMapping("/add")
    public String addForm(@ModelAttribute("member") Member member) {
        return "members/addMemberForm";
    }

    @PostMapping("/add")
    public String save(@Valid @ModelAttribute Member member, BindingResult result) {

        if (result.hasErrors()) {
            return "members/addMemberForm";
        }

        memberRepository.save(member);
        return "redirect:/";
    }
}
```

<br/>

회원용 테스트 데이터 추가

![이미지](/programming/img/나3.PNG)

`TestDataInit`  클래스 - 편의상 테스트용 회원 데이터를 추가하자.

```
loginId : test
password : test!
name : 테스터
```

<br/>

`TestDataInit`  클래스

```java
package hello.login;

import hello.login.domain.item.Item;
import hello.login.domain.item.ItemRepository;
import hello.login.domain.member.Member;
import hello.login.domain.member.MemberRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Component;

import javax.annotation.PostConstruct;

@Component
@RequiredArgsConstructor
public class TestDataInit {

    private final ItemRepository itemRepository;
    private final MemberRepository memberRepository;

    /**
     * 테스트용 데이터 추가
     */
    @PostConstruct
    public void init() {
        itemRepository.save(new Item("itemA", 10000, 10));
        itemRepository.save(new Item("itemB", 20000, 20));

        Member member = new Member();
        member.setLoginId("test");
        member.setPassword("test!");
        member.setName("테스터");
        memberRepository.save(member);
    }
}
```

<br/>

실행 시켜보면 여기서 회원 가입을 한다면

![이미지](/programming/img/나4.PNG)

<br/>

콘솔창에서 확인하면 되는 것이다.

![이미지](/programming/img/나5.PNG)