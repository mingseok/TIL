# π λΉµ λ¶€μ¤λ¬κΈ°
>κ°λ° κ΄€λ ¨ ν•™μµ μ¤‘ ν•λ‚μ κΈ€λ΅ μ‘μ„±ν•κΈ°μ—” μ§§κ³ , <br/>
>λ²„λ¦¬κΈ°μ—” μ•„κΉμ΄ λ¶€μ¤λ¬κΈ° μ •λ³΄λ“¤μ„ λ¨μ•„λ‘λ” κ³³. <br/> <br/>
>μ„μ‹λ΅ μ‘μ„±ν•κ² μ™„μ„± λλ©΄ λΉµμ΄ λμ–΄ λ‚κ°€λ” κ²ƒμ΄λ‹¤. <br/> 
>1κ°, 2κ°, 3κ°, ... λ¶€μ¤λ¬κΈ° λ“¤μ„ λ¨μ•„ λ‘κ³  μ μ  μ •λ¦¬ν•΄ κ°€λ” κ²ƒμ΄λ‹¤. <br/>
>μ •λ¦¬κ°€ λκ²ƒμ€ πμ΄ λμ–΄ ν•΄κ²°.
> ***



<br/>

## λ©μ°¨


---


### μ™ μΈλ±μ¤κ°€ ν•„μ”ν• κΉ?
ν…μ΄λΈ”μ— λ°μ΄ν„°κ°€ λ§μ•„μ§€λ©΄ μ „μ²΄ ν…μ΄λΈ”μ„ νƒμƒ‰(Full Table Scan) ν•λ©΄ μ‹κ°„μ΄ μ¤λ κ±Έλ¦½λ‹λ‹¤.
μΈλ±μ¤λ” μ±…μ λ©μ°¨μ²λΌ μ‘λ™ν•μ—¬, μ›ν•λ” λ°μ΄ν„°λ¥Ό λΉ λ¥΄κ² μ°Ύμ„ μ μλ„λ΅ λ•μµλ‹λ‹¤.

μΈλ±μ¤λ” λ‚΄λ¶€μ μΌλ΅ B-Tree(Balanced Tree) κµ¬μ΅°λ΅ μ €μ¥λ©λ‹λ‹¤.
MySQLμ΄ μΈλ±μ¤λ¥Ό μ‚¬μ©ν•λ©΄ κ²€μƒ‰ μ‹ μ΄μ§„ νƒμƒ‰κ³Ό κ°™μ€ λ°©μ‹μΌλ΅ λ°μ΄ν„°λ¥Ό λΉ λ¥΄κ² μ°Ύμ„ μ μμµλ‹λ‹¤.

μƒν™©	μΈλ±μ¤κ°€ ν•„μ”ν• μ΄μ 
WHERE μ΅°κ±΄λ¬Έμ— μμ£Ό μ‚¬μ©	νΉμ • μ΅°κ±΄μ— λ§λ” λ°μ΄ν„°λ¥Ό λΉ λ¥΄κ² μ°ΎκΈ° μ„ν•΄
JOIN μ—°μ‚°μ΄ λ§μ€ κ²½μ°	λ‘ ν…μ΄λΈ”μ„ μ—°κ²°ν•  λ• κ²€μƒ‰ μ†λ„λ¥Ό λ†’μ΄κΈ° μ„ν•΄
ORDER BY μ‚¬μ© μ‹	λ°μ΄ν„°λ¥Ό μ •λ ¬ν•  λ• μ„±λ¥μ„ μµμ ν™”ν•κΈ° μ„ν•΄
UNIQUE μ μ•½ μ΅°κ±΄	μ¤‘λ³µλμ§€ μ•λ” κ°’μ„ λ³΄μ¥ν•κΈ° μ„ν•΄

### μΈλ±μ¤ μƒμ„±

```sql
-- λ‹¨μΌ μΈλ±μ¤ μƒμ„±
CREATE INDEX idx_name ON users(name);

-- λ³µν•© μΈλ±μ¤ μƒμ„±
CREATE INDEX idx_name_email ON users(name, email);
```

### Primary Keyμ™€ Unique Index

```sql
-- ν…μ΄λΈ” μƒμ„± μ‹ κΈ°λ³Έ ν‚¤ μΈλ±μ¤
CREATE TABLE users (
    id INT NOT NULL AUTO_INCREMENT,
    name VARCHAR(50),
    email VARCHAR(50),
    PRIMARY KEY (id)
);

-- Unique μΈλ±μ¤
CREATE UNIQUE INDEX idx_unique_email ON users(email);
```

### Fulltext Index

```sql
-- κ²μ‹κΈ€ λ‚΄μ©μ— Fulltext μΈλ±μ¤ μƒμ„±
CREATE TABLE articles (
    id INT NOT NULL AUTO_INCREMENT,
    title VARCHAR(255),
    content TEXT,
    PRIMARY KEY (id),
    FULLTEXT (content)
);
```

### Composite Index μ‚¬μ© μμ‹

```sql
-- λ³µν•© μΈλ±μ¤ μƒμ„±
CREATE INDEX idx_user_info ON users(name, email);

-- λ³µν•© μΈλ±μ¤λ¥Ό ν™μ©ν• μΏΌλ¦¬
SELECT * FROM users
WHERE name = 'MinSeok' AND email = 'minseok@example.com';
```

### μΈλ±μ¤κ°€ ν¨κ³Όμ μΈ κ²½μ°μ™€ λΉ„ν¨κ³Όμ μΈ κ²½μ°

ν¨κ³Όμ μΈ κ²½μ°	λΉ„ν¨κ³Όμ μΈ κ²½μ°
WHERE μ΅°κ±΄μ— μμ£Ό μ‚¬μ©λλ” μ»¬λΌ	μ‘μ€ ν…μ΄λΈ”μ—μ„λ” μΈλ±μ¤κ°€ ν° μ΄μ μ΄ μ—†μ
JOIN μ—°μ‚°μ΄ μμ£Ό λ°μƒν•λ” κ²½μ°	μμ£Ό λ³€κ²½λλ” μ»¬λΌμ— μΈλ±μ¤λ¥Ό κ±Έλ©΄ μ¤νλ ¤ λΉ„ν¨μ¨
ORDER BY, GROUP BYμ— μ‚¬μ©λλ” κ²½μ°	WHERE μ΅°κ±΄ μ—†μ΄ λ‹¨μ μ΅°νν•λ” κ²½μ°

---



### MVCCμ ν•µμ‹¬ κ°λ…
Undo Log

μ΄μ „ λ°μ΄ν„°λ¥Ό λ³΄μ΅΄ν•μ—¬ νΈλμ­μ…μ μ¤λƒ…μƒ·μ„ μ κ³µ
Rollback μ‹ λ°μ΄ν„°λ¥Ό λ³µκµ¬ν•κ±°λ‚ κ³Όκ±° λ²„μ „μ„ μ½μ„ λ• μ‚¬μ©
Transaction ID (νΈλμ­μ… ID)

κ° νΈλμ­μ…λ§λ‹¤ κ³ μ ν• IDλ¥Ό λ¶€μ—¬ν•μ—¬ λ°μ΄ν„° λ²„μ „ κ΄€λ¦¬μ— μ‚¬μ©
Hidden Columns

InnoDB ν…μ΄λΈ”μ—λ” μ¨κ²¨μ§„ μ»¬λΌμ΄ μμΌλ©°, λ°μ΄ν„°μ λ²„μ „ μ •λ³΄λ¥Ό κ΄€λ¦¬
DB_TRX_ID : λ§μ§€λ§‰μΌλ΅ λ³€κ²½λ νΈλμ­μ… ID
DB_ROLL_PTR : Undo Logλ¥Ό κ°€λ¦¬ν‚¤λ” ν¬μΈν„°
Read View

νΈλμ­μ…μ΄ μ‹μ‘λ  λ• Read Viewκ°€ μƒμ„±λμ–΄, ν•΄λ‹Ή μ‹μ μ λ°μ΄ν„° μ¤λƒ…μƒ·μ„ κΈ°λ°μΌλ΅ μ΅°ν

### MySQL MVCC λ™μ‘ μμ‹
μ•„λ μμ‹λ¥Ό ν†µν•΄ νΈλμ­μ… κ°„μ μ¶©λμ΄ MVCCλ΅ μ–΄λ–»κ² ν•΄κ²°λλ”μ§€ ν™•μΈν•΄λ³΄κ² μµλ‹λ‹¤.

### μ‹¤μ „ μμ : MVCC νΈλμ­μ… μ²λ¦¬ κ³Όμ •

### ν…μ΄λΈ” μƒμ„±
sql
μ½”λ“ λ³µμ‚¬
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50),
    balance INT
);

INSERT INTO users (name, balance) VALUES ('MinSeok', 1000);


### νΈλμ­μ… μ‹λ‚λ¦¬μ¤: λ‘ νΈλμ­μ…μ΄ λ™μ‹μ— λ°μ΄ν„°λ¥Ό μ²λ¦¬
νΈλμ­μ… 1: μ‚¬μ©μ Aκ°€ μ΅°ν ν›„ μ—…λ°μ΄νΈ
sql
μ½”λ“ λ³µμ‚¬
-- νΈλμ­μ… 1 μ‹μ‘
START TRANSACTION;

-- ν„μ¬ λ°μ΄ν„° μ΅°ν
SELECT * FROM users WHERE name = 'MinSeok';

-- balanceλ¥Ό 1000 μ¦κ°€
UPDATE users SET balance = balance + 1000 WHERE name = 'MinSeok';
νΈλμ­μ… 2: μ‚¬μ©μ Bκ°€ λ™μΌν• λ°μ΄ν„°λ¥Ό μ΅°ν
sql
μ½”λ“ λ³µμ‚¬
-- νΈλμ­μ… 2 μ‹μ‘
START TRANSACTION;

-- ν„μ¬ λ°μ΄ν„° μ΅°ν
SELECT * FROM users WHERE name = 'MinSeok';

### νΈλμ­μ…μ΄ λ™μ‹μ— μ‹¤ν–‰λ  λ•μ MVCC λ™μ‘ κ³Όμ •

νΈλμ­μ… 1μ΄ λ°μ΄ν„°λ¥Ό μ½μ„ λ•, ν•΄λ‹Ή λ°μ΄ν„°μ μ¤λƒ…μƒ·μ΄ μƒμ„±λ©λ‹λ‹¤.
νΈλμ­μ… 2κ°€ λ™μΌν• λ°μ΄ν„°λ¥Ό μ΅°νν•  λ•, νΈλμ­μ… 1μ λ³€κ²½ μ‚¬ν•­μ€ λ³΄μ΄μ§€ μ•μµλ‹λ‹¤.
μ΄λ” MVCCκ°€ νΈλμ­μ…μ΄ μ‹μ‘λ μ‹μ μ μ¤λƒ…μƒ·μ„ μ κ³µν•κΈ° λ•λ¬Έμ…λ‹λ‹¤.

### κ²°κ³Ό ν™•μΈ: νΈλμ­μ…μ΄ μ™„λ£λ ν›„

νΈλμ­μ… 1 μ»¤λ°‹ ν›„ μƒνƒ:
sql
μ½”λ“ λ³µμ‚¬
-- νΈλμ­μ… 1 μ»¤λ°‹
COMMIT;
νΈλμ­μ… 2 μ»¤λ°‹ ν›„ μƒνƒ:
sql
μ½”λ“ λ³µμ‚¬
-- νΈλμ­μ… 2 μ»¤λ°‹
COMMIT;

### νΈλμ­μ… 2κ°€ μ΅°νν• λ°μ΄ν„°λ” νΈλμ­μ… 1μ λ³€κ²½ μ‚¬ν•­μ΄ λ°μλμ§€ μ•μ•λ μ‹μ μ μ¤λƒ…μƒ·μ„ κΈ°μ¤€μΌλ΅ μ΅°νν•©λ‹λ‹¤.

### Read Viewμ μ—­ν•  ν™•μΈ
sql
μ½”λ“ λ³µμ‚¬
-- νΈλμ­μ… μ‹μ‘
START TRANSACTION;

-- λ°μ΄ν„° μ΅°ν
SELECT * FROM users WHERE name = 'MinSeok';

-- κ²°κ³Ό
+----+---------+---------+
| id | name    | balance |
+----+---------+---------+
|  1 | MinSeok | 1000    |
+----+---------+---------+
νΈλμ­μ…μ΄ μ‹μ‘λ μ΄ν›„μ—λ” λ‹¤λ¥Έ νΈλμ­μ…μ΄ λ°μ΄ν„°λ¥Ό λ³€κ²½ν•΄λ„ ν„μ¬ νΈλμ­μ…μ μ΅°ν κ²°κ³Όλ” λ™μΌν•©λ‹λ‹¤.

π›  MVCCμ μ£Όμ” μ΄μ 
1οΈβƒ£ μ κΈ μ—†μ΄ λ™μ‹ μ½κΈ° μ²λ¦¬

λ°μ΄ν„°λ¥Ό μ½μ„ λ• λ‹¤λ¥Έ νΈλμ­μ…μ΄ λ³€κ²½ μ¤‘μ΄λ”λΌλ„ λ½ μ—†μ΄ μ½κΈ° κ°€λ¥
2οΈβƒ£ μΌκ΄€λ μ½κΈ°(Consistent Read)

νΈλμ­μ…μ΄ μ‹μ‘λ μ‹μ μ μ¤λƒ…μƒ·μ„ κΈ°μ¤€μΌλ΅ μΌκ΄€λ λ°μ΄ν„°λ¥Ό μ κ³µν•©λ‹λ‹¤.
3οΈβƒ£ Rollback κ°€λ¥

λ³€κ²½ μ‚¬ν•­μ΄ μ»¤λ°‹λμ§€ μ•μΌλ©΄ Undo Logλ¥Ό ν†µν•΄ μ΄μ „ μƒνƒλ΅ λ³µμ› κ°€λ¥ν•©λ‹λ‹¤.

### ν•µμ‹¬ ν¬μΈνΈ μ”μ•½
MySQLμ InnoDB μ—”μ§„μ€ MVCCλ¥Ό μ§€μ›ν•μ—¬ μΌκ΄€λ μ½κΈ°μ™€ λ™μ‹μ„± μ μ–΄λ¥Ό μ κ³µν•©λ‹λ‹¤.
MVCCλ” Undo Logλ¥Ό ν†µν•΄ μ΄μ „ λ²„μ „μ λ°μ΄ν„°λ¥Ό κ΄€λ¦¬ν•λ©°, νΈλμ­μ…μ΄ μ‹μ‘λ μ‹μ μ μ¤λƒ…μƒ·μ„ μ κ³µν•©λ‹λ‹¤.
νΈλμ­μ… κ²©λ¦¬ μμ¤€ μ¤‘ REPEATABLE READκ°€ MySQLμ κΈ°λ³Έ κ²©λ¦¬ μμ¤€μ΄λ©°, MVCCμ μ£Όμ” μ΄μ μ„ ν™μ©ν•©λ‹λ‹¤.

---

### λ€μΉ­ν‚¤ / κ³µκ°ν‚¤ / μ•”νΈν™” λ°©μ‹

λ€μΉ­ν‚¤
μ•”νΈν™”, λ³µνΈν™”μ— κ°™μ€ μ•”νΈν‚¤(λ€μΉ­ν‚¤)λ¥Ό μ‚¬μ©ν•λ” μ•κ³ λ¦¬μ¦

λ™μΌν• ν‚¤λ¥Ό μ£Όκ³  λ°›κΈ° λ•λ¬Έμ—, λ§¤μ° λΉ λ¥΄λ‹¤λ” μ¥μ .
κ·Έλ¬λ‚ λ€μΉ­ν‚¤ μ „λ‹¬κ³Όμ •μ—μ„ ν•΄ν‚Ή μ„ν—μ— λ…Έμ¶

κ³µκ°ν‚¤ / λΉ„λ€μΉ­ν‚¤
μ•”νΈν™”μ™€ λ³µνΈν™”μ— μ‚¬μ©ν•λ” μ•”νΈν‚¤λ¥Ό λ¶„λ¦¬ν• μ•κ³ λ¦¬μ¦

μμ‹ μ΄ κ°€μ§€κ³  μλ” κ³ μ ν• μ•”νΈν‚¤(λΉ„λ°€ν‚¤)λ΅λ§ λ³µνΈν™” ν•  μ μλ” μ•”νΈν‚¤(κ³µκ°ν‚¤)λ¥Ό κ³µκ°.

κ³Όμ •
1. Aκ°€ μ›Ή μƒμ— κ³µκ°λ Bμ κ³µκ°ν‚¤λ¥Ό μ΄μ©ν•΄ λ°μ΄ν„°λ¥Ό μ•”νΈν™” ν•μ—¬ Bμ—κ² μ†΅μ‹ 
2. Bλ” μκΈ°κ°€ κ°€μ§„ λΉ„λ°€ν‚¤λ΅ λ³µνΈν™”ν• λ°μ΄ν„°λ¥Ό ν™•μΈν›„, Aμ κ³µκ°ν‚¤λ΅ μ‘λ‹µμ„ μ•”νΈν™” ν•μ—¬ Aμ—κ² μ†΅μ‹ 
3. Aλ” μμ‹ μ λΉ„λ°€ν‚¤λ΅ μ‘λ‹µλ¬Έμ„ λ³µνΈν™”.
4. 

---

λ””μ§€ν„Έ μΈμ¦μ„μ—λ” λ¨λ‘κ°€ μ‹ λΆ°ν•  μ μλ” μ μ‚ΌμμΈ CAμ™€ λΉ„λ€μΉ­ν‚¤ μ•”νΈν™”κ°€ ν•„μ”.

Bλ” CAμ—κ² μμ‹ μ΄ Bμ„μ„ μ¦λ…ν•κ³  μμ‹ μ κ³µκ° ν‚¤κ°€ Bμ κ³µκ° ν‚¤κ°€ λ§μμ„ μΈμ¦ν•λ” μΈμ¦μ„ λ°κΈ‰.

Aμ—κ² Bμ κ³µκ°ν‚¤κ°€ ν¬ν•¨λ μ΄ μΈμ¦μ„λ¥Ό μ£Όλ©΄,

μ΄λ¥Ό λ°›μ€ Aλ” μμ‹ μ΄ μ‹ λΆ°ν•  μ μλ” CAμ—κ² CAκ°€ μ§„μ§ λ°κΈ‰ν• μΈμ¦μ„μΈμ§€ ν™•μΈν•κ³ ,

λ§μΌλ©΄ κ·Έ μΈμ¦μ„μ— ν¬ν•¨λ Bμ κ³µκ° ν‚¤λ΅ λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•΄μ„ Bμ—κ² μ „λ‹¬

λ§μ•½ μµμΆ…μ μΌλ΅ Bκ°€ μ¬λ°”λ¥΄κ² μμ‹ μ κ°μΈν‚¤λ΅ λ³µνΈν™”ν•λ‹¤λ©΄, CAκ°€ μΈμ¦ν•λ” Bμ κ³µκ°ν‚¤μ— λ€μ‘ν•λ” κ°μΈν‚¤λ¥Ό κ°€μ§€κ³  μλ‹¤λ” κ²ƒμ΄λ―€λ΅, μ΄ κ³Όμ •μ„ ν†µν•΄ ν„μ¬ ν†µμ‹ ν•κ³  μλ” μƒλ€λ°©μ΄ Bκ°€ λ§μμ„ μΈμ¦ν•  μ μμ.
