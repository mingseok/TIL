## Isolation 비정상적인 현상

<br/>

## Dirty read

데이터 베이스에 `x = 10, y = 20` 값을 가지고 있다.

이런 상황에서 두개의 트랜잭션을 실행한다고 한다면?



```java
--"상황 예시"--
1. 트랙잭션1은 x에 y를 더하는 역할.
2. 트랜잭션2은 y를 70으로 변경 시키는 역할.
3. 트랜잭션1번과 트랜잭션2번을 동시에 실행한다면?
```

<br/>

![이미지](/programming/img/입문453.PNG)


<br/>

### 동작 순서 하나씩 설명

1. 먼저 트랜잭션1이 동작하여 `x에 y를 더하려고 한다` 

    - 현재 x의 값이 얼마인지 알아야 하기에 x를 읽는다 `read(x) → 10`

2. 그리고 `y의 값을 읽으려는 순간`, 트랜잭션2가 y를 70으로 변경 시켰다.

    - 데이터 베이스에는 `y = 20 이였으나, y = 70으로 업데이트`가 될 것이다.

3. 곧 이어, 트랜잭션1번이 이어 y의 값을 읽는다. `read(y) → 70`

4. 그러고, x에 y를 더한다. (트랜잭션1번의 역할 수행) 10 + 70 더하여 → 80을 x에 업데이트한다.

    - 그러고 트랜잭션1번은 커밋 하고 종료를 한다.

5. 그런데, 트랜잭션2번이 문제가 생겨 `rollback를 하게 된 상황이다.`

    - 트랜잭션2번은 `이전 상태`로 돌아가야 하기 때문에 `y = 20인 상태로 돌아간다.`

    - 데이터베이스에도 `y = 70`이였으나 -> `이전 상태인 20으로 돌아간다.`

<br/><br/>

## 정리

`문제 발생)` x = 80은 트랜잭션1번이 트랜잭션2번의 y = 70인 상태에서의 데이터를 읽고, 계산하여 나온 데이터이다.

- 즉, 트랜잭션2번이 rollback 하였기에, `70 이란 값은 이젠 유효한 값이 아니다.`

```java
그렇기에 트랜잭션1번에서 진행했던 "x = 80도 정상적인 값이 아니라는 말이된다"

그리하여 "데이터베이스의 80은 이상한 값이 되는것이고", 이런 상황을 "Dirty read"라고 부른다. 
(커밋되지 않은 변화를 읽음)
```

<br/><br/>


## Non-repeatable read

데이터 베이스에 `x = 10` 값을 가지고 있다.

이런 상황에서 두개의 트랜잭션을 실행한다고 한다면?

```java
--"상황 예시"--
1. 트랙잭션1은 x를 두번 읽는 역할.
2. 트랜잭션2은 x에 40을 더하는 역할.
3. 트랜잭션1번과 트랜잭션2번을 동시에 실행한다면?
```

<br/>

![이미지](/programming/img/입문454.PNG)

<br/>

### 동작 순서 하나씩 설명

1. 먼저 트랜잭션1이 동작하여 x를 한번 읽는다. `read(x) → 10`

2. 그리고 트랜잭션2번이 동작하면서, `x에 40을 더해야 하기 때문에 일단 x를 한번 읽는다.` 

3. 곧 이어, 트랜잭션2번이 10이란 값에 40을 더해서 x = 50이 된다. `write(x = 50)`

4. 그러고 트랜잭션2번은 커밋 하고 종료를 한다.

5. `문제 발생)` 이어서, 트랜잭션1번이 다시 x를 또 읽는다.

    - 하지만, `트랜잭션2번에 의해서 x의 값이 변경되어 있는 것을 알 수 있다.`

6. 그러고, 트랜잭션1번도 커밋하고 종료한다.

<br/><br/>

## 정리

상황을 보면 트랜잭션1번이 수행을 하는 동안에 x를 두번 읽었는데 값이 다른 것이다.

- 같은 데이터를 한 트랜잭션안에서 두번 읽었는데도, 서로 다른 값이 출력 된것이다.

```java
"isolation 관점에서 보면 일어나면 안되는 현상이다."

트랜잭션 아이솔레이션 속성에서 의미하는 것은 
여러 트랜잭션이 "동시에 실행"되어도 각각의 트랜잭션이 마치 
"혼자서 실행되는 것처럼 동작"해야 된다는 것이 아이솔레이션 속성이다.
```

<br/><br/>

## Phantom read

데이터 베이스에 2개의 튜플이 있다.

- 1번 튜플은 v = 10으로 가지고 있다.

- 2번 튜플은 v = 50으로 가지고 있다.

<br/>

이런 상황에서 두개의 트랜잭션을 실행한다고 한다면?

```java
--"상황 예시"--
1. 트랙잭션1은 v가 10인 데이터를 두번 읽는 역할.
2. 트랜잭션2은 t2의 v를 10으로 변경시키는 역할.
3. 트랜잭션1번과 트랜잭션2번을 동시에 실행한다면?
```

<br/>

![이미지](/programming/img/입문455.PNG)

### 동작 순서 하나씩 설명

1. 먼저 트랜잭션1이 동작하여 v를 한번 읽는다. `read(v = 10) → t1`

    - 현재는 v가 10인 튜플이 t1밖에 없으니 t1만 읽는 것이다.

2. 그리고 트랜잭션2번이 동작하면서, t2의 v값을 10으로 변경시킨다.

    - (t2.v = 50) 에서 → (t2.v = 10) 으로 변경한다.

3. 곧 이어, 트랜잭션2번은 커밋을 한다.

4. `문제 발생)` 그러면, 트랜잭션1번이 실행을 할것이다. 

    - 그런데, 처음에는 t1만 반환 했었는데, t1, t2 둘다 반환 하게 되는 것이다.
    
5. 그러고 트랜잭션1번은 커밋을 한다

<br/><br/>

## 정리

동일한 조건으로 두번을 읽었는데, 각각의 결과가 다른 것이다.

```java
"isolation 관점에서 보면 일어나면 안되는 현상이다."

하나의 트랜잭션 안에서 같은 조건으로 두번 읽었는데,
두번의 결과가 다르기에 나오는 경우 또한, "이상 형상"이라고 판단한다.
```