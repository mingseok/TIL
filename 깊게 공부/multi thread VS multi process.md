## multi thread VS multi process



프로세스란 실행중인 프로그램을 뜻합니다.

<br/>

즉, 실행파일 형태로 존재하던 프로그램이 메모리에 적재되어 

CPU에 의해 실행 되는 것을 프로세스라고 합니다.

<br/>

### 프로세스 내에서도 각 용도에 따라 메모리 영역이 구분되어 있습니다.

- 코드 영역

    - 우리가 코드를 짜서 컴파일 한 이후에, 기계어로 번역된 코드들을 코드 영역

- 데이터 영역

    - 전역 변수, static 변수 경우는 데이터 영역에 저장을 하게  되는 영역

- 힙 영역

    - 런타임 중에 메모리 할당이 되는 동적 메모리 할당을 힙 영역에서 진행하게 된다.

- 스택 영역

    - 함수에서 쓰이는 지역변수나 매개 변수 이런 것들이 스택 영역에 저장 된다.

<br/><br/>

## 대부분의 사람들은

하나의 프로세스만 사용하기 보다는 여러 가지를 동시에 사용하고 싶어 한다!

![이미지](/programming/img/입문429.PNG)

<br/>

하지만, 한 프로세스가 실행되기 위해서는 `cpu`를 점유하고 있으면,

다른 프로세스들은 실행 상태에 있을 수가 없다.

```java
ex) 큰 용량의 메일을 보내는 중인데, 
    인텔리제이 켜면 보내고 있던 메일은 꺼져 버린다는 것이다.
```

<br/><br/>

## 그리하여

다수의 `프로세스`를 동시에 실행하기 위해 여러 프로세스를 `시분할`로 

짧은 텀을 반복하면서, 전환하며 실행 시키도록 한다는 것이다.

- `“왜?”` → CPU는 `하나`이기 때문이다.
    - `프로세스1`이 CPU로 갔다가 → 다시 준비 상태로 되고,
        
        `프로세스2`가 CPU로 갔다가 → 다시 준비 상태로 되는 것을 반복한다
        
    - 이것이, `컨테스트 스위칭` 이라고 한다.

```java
하지만, 이방법은 너무나 피곤하다. 그렇기에 나온것이 -> "스레드"
```

<br/><br/>

## 스레드 설명

스레드는 한 프로세스 내에서 나뉘어진 하나 이상의 실행 단위이다

하나의 프로세스 안에 다수의 스레드가 있을 때, 스레드끼리는 자원을 공유하고 있다.

<br/>

여기서, 스레드는 JVM에 `Code`, `Metaspace`, `Heap` 영역을 공통된 자원으로 사용한다.

- 각각의 스레드는 스택 부분만을 따로 가진다.

```java
이렇게 사용시 장점은?

공유되는 자원이 있기 때문에 이전처럼 "컨텍스트 스위칭"이 
일어날 때, "캐싱 적중률"이 올라간다는 것이다.

(쉽게 생각하면, 안에 있는걸 다빼고, 다시 다넣을 필요가 없다는 뜻)
```

<br/><br/>

## multi thread VS multi process

두 가지 모두 `“처리방식의 일종”`이라는 것이다.

- 즉, 한 어플리케이션에 대한 두가지 다른 처리방식에 대해서 공부한다 생각하기

<br/>

### 예를 들어,

여러 사용자가 `로그인`을 요청하는 상황이 있다고 생각해보자.

<br/>

한 `프로세스`는 매번 하나의 로그인만 
처리할 수 있기 때문에 동시에 처리할 수 없다.

<br/>

그리하여 `부모 프로세스`가 `fork()`를 한다. 

그리고 자식 프로세스를 여러 개 만들어서 일을 처리하도록 한다. 

(이때, 자식 프로세스는 부모와 별개로 `메모리 영역`을 확보한다.)

<br/>

반면 스레드는 한 프로세스 안에서 만들어진 `“실행 단위"`이다.

- 실행 단위 : `cpu core`에서 실행하는 하나의 단위이다.

    - 즉, `프로세스`의 하나 밖에 없는 `스레드`가 실행 단위가 되는 것이다.

```java
프로세스 내에서 분리하고, ->
여러 스레드로도 나누어진다면, 그것이 "멀티스레드"가 되는 것이다.
```

- ex) 내가 코드를 수정하는 동시에, 인텔리제이에서 추천 코드를 보여줄 때

- ex) 테스트코드를 돌리는 동시에 소스 코드도 수정해야 될 때

<br/>

이렇게 한 어플리케이션에 대한 `작업의 단위`가 나누어질때가 많다는 것이다.

이때 각각의 스레드가 그 작업들을 담당하게 되는 것이다.

<br/><br/>

## 차이점

### 멀티 프로세스

- `프로세스`는 독립적이기 때문에 `IPC`를 사용한 통신을 해야 한다

    - IPC : 각자의 방에 있다가 할 얘기가 있으면, 나와 얘기하고 다시 각자의 방으로 가는 것

- 자원이 소모적, 개별 메모리 차지
- `Context Switching` 비용이 크다

- 개별 독립적이기 때문에 동기화 작업에 신경을 덜 써도 된다.

<br/>

### 멀티 스레드

- 공유 자원이 많으므로 연결되어 있다.

    - 공유된 자원으로 메모리가 효율적이고 통신 비용도 절감 된다

- `Context Switching` 비용도 적다

<br/><br/>

## 컴퓨터는 왜 멀티 프로세스를 이용할까?

여러 창의 띄워 작업을 하다가, 이런 창이 뜨면 창 전체가 꺼져 버린다.

![이미지](/programming/img/입문430.PNG)

<br/>

### 이유가 뭐야?

멀티스레드를 이용했기 때문이다.

<br/>

스레드끼리 연결되어 있기 때문에 한 스레드, 즉, 한 탭에 문제가 생기면 

전체 프로세스에 영향이 가게 되는 것이기 때문이다.

<br/>

반면, 구글 크롬은 멀티프로세서를 이용하기 때문에 

멀티탭 간의 영향을 덜 받는다는 것이다.

<br/><br/>

## 정리

- 한 어플리케이션에 대한 작업을 동시에 하기 위해서는 `2가지` 처리 방식
     (멀티 프로세스, 멀티 스레드)이 있다.
    
- 동시에 실행이 되는 것처럼 보이기 위해서 실행 단위는 시분할로
     `cpu`를 점유하며 `context switching`을 한다
    
- 멀티 프로세스는 독립적인 메모리를 가지고 있지만 멀티 스레드는 자원을 공유한다.