## transaction 설명

둘 다 정상 처리 돼야만 성공하는 단일 작업을 말합니다.

즉, 둘 중에 하나만 성공한다면 정상적으로 성공하지 않는 작업인 것이다.

- `transaction`의 SQL문들 중에 `일부만 성공해서 DB에 반영되는 일은 일어나지 않는다`

```java
"데이터베이스에서 트랜잭션은 하나의 거래를 안전하게 처리하도록 보장해주는 것을 뜻한다."
```

<br/>

### 예를 들어서

A의 5000원을 B에게 계좌이체 한다고 생각해보자.

```
1. A의 잔고를 5000원 감소하고,
2. B의 잔고를 5000원 증가해야 한다.

```

계좌이체라는 거래는 이렇게 2가지 작업이 합쳐져서 하나의 작업처럼 동작해야 한다.

<br/><br/>

## 문제점.

만약 1번은 성공했는데, 2번에서 시스템에 문제가 발생하면 계좌이체는 실패하고,

A의 잔고만 5000원 감소하는 `심각한 문제`가 발생한다.

<br/>

데이터베이스가 제공하는 트랜잭션 기능을 사용하면 1, 2 둘다 함께 성공해야 `저장`하고,

중간에 하나라도 실패하면 거래 `전의 상태`로 돌아갈 수 있다.

즉, 거래 전의 상태로 완전히 돌아간다.

<br/>

모든 작업이 성공해서 데이터베이스에 `정상` 반영하는 것을 `커밋( Commit )`이라 하고,

작업 중 하나라도 `실패`해서 거래 이전으로 되돌리는 것을 `롤백( Rollback )`이라 한다.

<br/>

### 커밋(commit) 이란?

- 지금까지 작업한 내용을 DB에 영구적으로 저장한다는 것이다.

- transaction을 종료한다는 뜻도 있다.

<br/>

### rollback이란?

- 지금까지 작업들을 모두 취소하고 transaction 이전 상태로 되돌린다.

- transaction을 종료한다

<br/><br/>

## 커밋을 호출하기 전까지는 `임시로 데이터를 저장`하는 것이다.

따라서 해당 트랜잭션을 시작한 사용자 에게만 변경 데이터가 보이고

다른 사용자에게는 변경 데이터가 보이지 않는다.

- 등록, 수정, 삭제 모두 같은 원리로 동작한다.

<br/><br/>

## @@autocommit 개념

자동 커밋 (디폴트가 true이다.)

- 자동 커밋으로 설정하면 각각의 쿼리 실행 직후에 자동으로 커밋을 호출한다.
    
    따라서, 커밋이나 롤백을 직접 호출하지 않아도 되는 편리함이 있다.
    

```java
"자동으로 커밋하면 좋은거 아닌가?"

두 작업을 한다고 생각해보자.
1. 나의 돈 5000천원을 뺀다.
2. 상대방에 5000천원 넣는다.

“나의 돈 5000천원을 뺀다” 에서 바로 자동 커밋이 되어 버린다.
그리고 “상대방에 5000천원 넣는다” 를 진행해야 되는데, 상대방이 카드를 해지해 버린 것이다.
결과적으로 상대방에 5000천원은 들어가지 않고, 내 돈 5000천원만 빠져 나간 것이다.
```

<br/><br/>

## 트랜잭션은 ACID를 위한 무결성 제약을 정의한다.

### A - Atomocity 원자성

트랜잭션과 관련된 작업은 모두 실행 완료되거나, 실패 시 모두 이전으로 돌아가야 한다는 특성이다

```java
내가 친구한테 10000원을 보낸다면,

내 잔액  -10000원
친구 잔액 +10000원
이 둘줄 하나만 처리된다면 원자성(Atomicity) 위반이다.
```

<br/>

### C - Consistency 일관성

- 트랜잭션이 실행을 성공적으로 완료하면 항상 일관성 있는 데이터베이스인 상태로 유지하는 것을 의미합니다.
    

```java
잔액 : 0보다 커야한다.
돈도 없는데 친구한테 송금이 가능해서는 안된다.

e.g.)
만약, 내 계좌에 8만원이 있고, 상대방 계좌로 10만원을 송금을 하려고 하는 상황에서
테이블을 설계할시 check(balance >= 0) 체크제약 사항을 걸어둔다면,
음수가 될 수 없는 것처럼 일관성을 유지할 수 있는 것입니다. 
그리하여, 결론적으로 트랜잭션은 실패하게 되고, 롤백이 되는 것입니다.
```

<br/>

### I - Isolation 격리성

- 둘 이상의 트랜잭션이 동시에 실행되는 경우, 서로 독립적으로 실행되어야 한다.
    
    즉, 한 트랜잭션이 실행하는 동안의 중간 결과를 다른 트랜잭션이 접근할 수 없다.
    

```java
트랜잭션 1, 2, 3, 4가 거의 동시에 수행되더라도
1 -> 2 -> 3 -> 4 와 같이 수행한 것처럼 되게 하라

실행 중인 트랜잭션의 중간 결과는 다른 트랜잭션이 참조하거나 변경할 수 없다
동시에 병행 처리한다고 하더라도, 각 트랜잭션은 독립적으로 연속되어 실행한 
결과와 같아야 한다.
```

<br/>

### D - Durability 지속성

- 성공적으로 완료된 트랜잭션 결과는 영구 기억장치에 반영 되어야 합니다.

```java
완료(commit) 된 트랜잭션은 데이터베이스에 영구적으로 보존되어야 한다.

완료 후에 컴퓨터가 꺼진다면 데이터는 이미 저장되었으므로 보존된다.
완료 전에 컴퓨터가 꺼진다면 데이터는 Atomicity 원칙을 따라, 
트랜잭션 수행하기 전으로 돌아간다.
```