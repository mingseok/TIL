## 싱글톤 패턴 (Singleton Pattern)

싱글톤 패턴은 인스턴스를 오직 1개만 생성하는 패턴입니다.

예를 들면, 디비 커넥션이나 스레드 풀 객체를 생성할 때 사용합니다.

<br/><br/>

## 코드로 확인

```java
public class Singleton {

    private static Singleton instance = new Singleton();
    
    private Singleton() {
        // 생성자는 외부에서 호출하지 못하게 private 으로 지정해야 한다.
    }

    public static Singleton getInstance() {
        return instance;
    }
}
```

<br/><br/>

## 싱글톤 패턴을 사용하는 이유는?

```java
인스턴스를 오직 한개로만 가져가면 어떤 좋은점이 있다는 거지?
```

<br/>

### 메모리 측면

최초 한번의 `new` 연산자를 통해서 고정된 메모리 영역을 사용하기 때문에 

추후 해당 객체에 접근할 때, 메모리 낭비를 방지할 수 있다

<br/>

### 데이터 공유가 쉽다

싱글톤 인스턴스가 전역으로 사용되는 인스턴스이기 때문에, 

다른 클래스의 인스턴스들이 접근하여 사용할 수 있다

```java
데이터 공유의 문제점!
- 여러 클래스의 인스턴스에서 싱글톤 인스턴스의 데이터를 
  동시에 접근하게 되면 동시성 문제가 발생할 수 있으니 이점을 유의해야 한다
```

<br/><br/>

## 이렇게

도메인 관점에서 인스턴스가 한개만 존재하는 것을 

보증하고 싶은 경우 싱글톤 패턴을 사용한다

<br/><br/>


## 싱글톤 패턴 문제점

- 의존관계상 클라이언트가 구체 클래스에 의존한다. `DIP`를 위반한다.

- `테스트`하기 어렵다.

- 내부 속성을 변경하거나 `초기화` 하기 어렵다.

- `private` 생성자로 자식 클래스를 만들기 어렵다.

- 결론적으로 `유연성`이 떨어진다.

- 안티패턴으로 불리기도 한다.

<br/><br/>

## 문제점 정리

싱글톤 패턴은 안티패턴으로 불릴 만큼 단독으로 사용한다면 

객체 지향에 위반되는 사례가 많다는 것이다 

- 단일 책임 원칙을 위반합니다.

- 테스트하기가 어렵다는 것이다

- `DIP`를 위반, `OCP` 원칙 또한 위반할 가능성이 있다.

```java
스프링 컨테이너 같은 프레임워크의 도움을 받으면 
싱글톤 패턴의 문제점들을 보완하면서 장점의 혜택을 누릴 수 있다
```

<br/><br/>

## 싱글톤 패턴은 언제 사용 되는 건가요?

싱글톤은 스프링에서 사용 됩니다

- 스프링에서 싱글톤을 저장하고, 관리해주는 친구가 바로 `applicationContext` 이다.
    - 명칭은 : IOC 컨테이너, 스프링 컨테이너, 빈 팩토리 등으로 불린다.

- DB 커넥션

    - 자바는 데이터 베이스를 연결할때, 커넥션 객체를 하나 만들어서
        
        데이터 베이스와 통신을 한다. → 여기서 DB와 계속해서 연결을 유지하지 않는다.
        
        - 끊고 → 연결 → 끊고 → 연결 → (반복)
            - 그렇기에, 매번 커넥션 객체 생성하는 것이 아니라,
                
                만들어 놓고 필요할 때 마다 가져다 쓰는 것이다.
                
- 스레드 풀
    - 스레드는 생성하는데 시간이 오래 걸린다.
        - 그렇기에, 미리 스레드를 여러개 만들어 놓고
            
            사용 → 반납 → 사용 → 반납 하는 것이다.
            

<br/><br/>

## 스프링은 왜 Bean 을 Singleton으로 생성할까?

스프링에서 하나의 요청을 처리하기 위해서는 다양한 기능을 

담당하는 객체들이 계층형을 이루고 있다고 한다. 

```java
클라이언트 요청 마다 각 로직을 담당하는 객체를 만들어 사용한다면,
GC가 있더라도 메모리 부하가 올 수 있다는 점이다
```

<br/>

서블릿은 대부분의 멀티 스레딩 환경에서 싱글톤을 동작하며 

서블릿 클래스 하나당 하나의 객체를 생성하여, 

클라이언트 요청 처리를 담당하는 스레드들이 해당 객체를 공유해서 사용한다

<br/><br/>

## 그렇다면, 스프링은 어떻게 빈을 싱글톤으로 생성할까?

Bean을 어떻게 만드는지 생각하면 된다

- 스프링은 어노테이션 설정만으로 IoC 컨테이너에 제어권을 넘겨줌으로써
    
    손쉽게 Bean을 싱글톤으로 생성하여 사용할 수 있다
    

```java
Component-scan 대상이 되는 어노테이션들 
@Repository, @Service, @Controller, @Component 등을 사용하면 된다
```