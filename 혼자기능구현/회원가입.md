## 회원가입 로직

## application.properties

```
spring.datasource.url=jdbc:mysql://localhost:3306/facegram?autoReconnect=true
spring.datasource.username=root
spring.datasource.password=1234

mybatis.mapper-locations=classpath:mapper/**/*.xml
mybatis.configuration.map-underscore-to-camel-case=true
```

<br/><br/>

## FacegramApplication

```java
package com.project.facegram;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
@MapperScan(basePackages = "com.project.facegram")
public class FacegramApplication {

    public static void main(String[] args) {
        SpringApplication.run(FacegramApplication.class, args);
    }
}
```

<br/><br/>

## 테이블

```sql
# 맴버 테이블
create table members (
     id          int auto_increment,
     login_id    varchar(10) not null,
     member_pwd  varchar(80) not null,
     member_name varchar(10) not null,
     email       varchar(50) not null,
     join_date   datetime    not null, -- 만든 날짜.
     primary key (id)
);
```

<br/><br/>

## 처음 domain 클래스를 만들어 주자.

```java
import lombok.Data;

import java.time.LocalDateTime;

@Data
public class Member {
    private int id;
    private String loginId;
    private String memberPwd;
    private String memberName;
    private String email;
    private LocalDateTime joinDate;
}
```

<br/><br/>

## dto 패키지 → MemberDto

```java
package com.project.facegram.dto;

import lombok.Data;

import java.time.LocalDateTime;

@Data
public class MemberDto {
    private int id;
    private String loginId;
    private String memberPwd;
    private String memberName;
    private String email;
    private LocalDateTime joinDate;
}
```

<br/><br/>

## controller 패키지 → MemberController

```java
package com.project.facegram.controller;

import com.project.facegram.dto.MemberDto;
import com.project.facegram.service.MemberService;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;

@Controller
@RequiredArgsConstructor
public class MemberController {

    private final MemberService memberService;

    @GetMapping("/main")
    public String main() {
        return "members/main";
    }

    @GetMapping("/sign-up")
    public String signup(Model model) {
        model.addAttribute("memberDto", new MemberDto()); // 그릇도 같이 보내는 것이다.
        return "members/sign-up";
    }

    @PostMapping("/sign-up")
    public String signUp(@ModelAttribute MemberDto memberDto) {
    
        // @ModelAttribute 를 이용하여 html에 있는 MemberDto를 사용하는 것이다.
        memberService.joinMember(memberDto);
        return "redirect:/";
    }
}
```

<br/><br/>

## service 패키지 → MemberService

```java
package com.project.facegram.service;

import com.project.facegram.dto.MemberDto;
import com.project.facegram.mapper.MemberMapper;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDateTime;

@Service
@Transactional
@RequiredArgsConstructor
@Slf4j
public class MemberService {

    private final MemberMapper memberMapper;

    public void joinMember(MemberDto memberDto) {

        // 여기서 현재시간으로 로직 수정 한것이다.
	// setJoinDate를 사용 할 수 있는 이유는 memberDto 객체를 가져 왔기 때문이다.
	// 헷갈리지 말기. setJoinDate 이다. joinMember 가 아니다!!!!
        memberDto.setJoinDate(LocalDateTime.now());

        log.info(memberDto.getUserId()); // alstjr706

        memberMapper.joinMember(memberDto); // 디비에 보내는 코드이다.
    }
}
```

<br/><br/>

## mapper 패키지 → MemberMapper

```java
package com.project.facegram.mapper;

import com.project.facegram.dto.MemberDto;
import org.springframework.stereotype.Repository;

@Repository
public interface MemberMapper {
    void joinMember(MemberDto memberDto);
}
```

<br/><br/>

## resources 폴더 → mapper 패키지 → MemberMapper.xml

```sql
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.facegram.mapper.MemberMapper">
    <insert id="joinMember" parameterType="com.project.facegram.dto.MemberDto">
				insert into members
        (login_id, member_pwd, member_name, email, join_date)
        values(#{loginId},#{memberPwd},#{memberName},#{email},#{joinDate});
    </insert>
</mapper>
```

<br/><br/>

## resources 폴더 → templates → index.html

```html
<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments.html :: head"></head>

<body class="bg-white">
<div th:replace="fragments.html :: main-nav"></div>
<div class="container justify-content-center" style="width: 1150px">
    <div class="row justify-content-center">
        <div class="col-12">

        </div>
    </div>

    <div class="row">
        <h4 style="margin-top: 3%; font-size: 20px">인기 게시물
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-camera2"
                 viewBox="0 0 16 16">
                <path d="M5 8c0-1.657 2.343-3 4-3V4a4 4 0 0 0-4 4z"/>
                <path d="M12.318 3h2.015C15.253 3 16 3.746 16 4.667v6.666c0 .92-.746 1.667-1.667 1.667h-2.015A5.97 5.97 0 0 1 9 14a5.972 5.972 0 0 1-3.318-1H1.667C.747 13 0 12.254 0 11.333V4.667C0 3.747.746 3 1.667 3H2a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1h.682A5.97 5.97 0 0 1 9 2c1.227 0 2.367.368 3.318 1zM2 4.5a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0zM14 8A5 5 0 1 0 4 8a5 5 0 0 0 10 0z"/>
            </svg>
        </h4>
    </div>

</div>
</body>
</html>
```

<br/><br/>

## resources 폴더 → templates → fragments.html

```html
<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:fragment="head">
    <meta charset="UTF-8">
    <title>facegram</title>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
            crossorigin="anonymous"></script>
</head>

<body>
<nav th:fragment="main-nav" class="navbar navbar-expand-sm navbar-light" style="background-color: lightblue">
    <a id="logo-img" class="navbar-brand" href="/" th:href="@{/}">
        <img src="/images/chatOn.png" width="30" height="30" style="margin-left: 30px">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item mr-2">
                <form th:action="@{/searchTag}" class="form-inline" method="get">
                    <input class="form-control mr-sm-2" name="tagTitle" type="search" placeholder="검색"
                           aria-label="Search"/>
                </form>
            </li>
            <li class="nav-item" style="margin-left: 15px">
                <a class="nav-link" th:href="@{/}" style="color: black">Chaton</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/postList}" style="color: black">커뮤니티</a>
            </li>
        </ul>

        <ul class="navbar-nav" id="nav-list" style="margin-left: auto">
            <li class="nav-item" sec:authorize="!isAuthenticated()">
                <a class="nav-link" th:href="@{/login}">로그인</a>
            </li>
            <li class="nav-item" sec:authorize="!isAuthenticated()">
                <a class="nav-link" th:href="@{/sign-up}">회원가입</a>
            </li>
            <li class="nav-item" sec:authorize="isAuthenticated()">
                <a class="nav-link" th:href="@{'/profile/'}">
                    <i class="fa fa-plus" aria-hidden="true"></i> 내 게시물
                </a>
            </li>
            <li class="nav-item" sec:authorize="isAuthenticated()">
                <a class="nav-link" th:href="@{/admin}">회원관리</a>
            </li>
            <li class="nav-item" sec:authorize="isAuthenticated()">
                <div class="btn-group">
                    <a class="btn dropdown-toggle" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown"
                       aria-expanded="false" style="background: lightblue">
                        <img src="/image/profile.png" width="24" height="24" class="rounded border bg-light"/>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuLink" style="width: 100px">
                        <a class="dropdown-item" th:href="@{'/profile/'}">프로필</a>
                        <a class="dropdown-item" th:href="@{'/new-post'}">새 글 작성</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#" th:href="@{'/settings/profile'}">설정</a>
                        <form class="form-inline my-2 my-lg-0" action="#" th:action="@{/logout}" method="post">
                            <button class="dropdown-item" type="submit">로그아웃</button>
                        </form>
                    </ul>
                </div>
            </li>
        </ul>
    </div>
</nav>
</body>
</html>
```

<br/><br/>

## resources 폴더 → templates → members 패키지 → sign-up.html

```html
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments.html :: head"></head>
<body class="bg-white">
<div th:replace="fragments.html :: main-nav"></div>
<div class="container">
  <br>
  <div class="py-9 text-center">
    <h4>chatOn</h4>
    <h2>회원가입</h2>
  </div>
  <div class="row justify-content-center">
    <form class="needs-validation col-sm-6" action="#"
          th:action="@{/sign-up}" th:object="${memberDto}" method="post" novalidate>
      <!--th:object="${memberDto}는 받은 객체 memberDto-->

      <div class="form-group">
        <label for="userId">ID</label>
        <input id="userId" type="text" th:field="*{loginId}" class="form-control"
               placeholder="id" aria-describedby="loginIdHelp" required minlength="5" maxlength="10">
        <small id="loginIdHelp" class="form-text text-muted">
          영문자와 숫자를 포함하여 5~10자 이내로 작성해주세요.
        </small>
        <small class="invalid-feedback">아이디를 다시 입력하세요.</small>
        <small class="form-text text-danger" th:if="${#fields.hasErrors('loginId')}" th:errors="*{loginId}">loginId Error</small>
      </div>

      <div class="form-group">
        <label for="password">비밀번호</label>
        <input id="password" type="password" th:field="*{memberPwd}" class="form-control"
               placeholder="password" aria-describedby="passwordHelp" required minlength="8" maxlength="15">
        <small id="passwordHelp" class="form-text text-muted">
          영문자, 숫자, 특수기호를 포함하여 8~12자 이내로 작성해주세요.
        </small>
        <small class="invalid-feedback">패스워드를 다시 입력하세요.</small>
        <small class="form-text text-danger" th:if="${#fields.hasErrors('memberPwd')}" th:errors="*{memberPwd}">memberPwd Error</small>
      </div>

      <div class="form-group">
        <label for="nickname">닉네임</label>
        <input id="nickname" type="text" th:field="*{memberName}" class="form-control"
               placeholder="nickname" aria-describedby="nicknameHelp" required minlength="2" maxlength="10">
        <small id="nicknameHelp" class="form-text text-muted">
          문자와 숫자만 가능합니다. 2~10자 이내로 작성헤주세요.
        </small>
        <small class="invalid-feedback">닉네임을 다시 입력하세요.</small>
        <small class="form-text text-danger" th:if="${#fields.hasErrors('memberName')}" th:errors="*{memberName}">memberName Error</small>
      </div>

      <div class="form-group">
        <label for="email">이메일</label>
        <input id="email" type="email" th:field="*{email}" class="form-control"
               placeholder="your@email.com" aria-describedby="emailHelp" required>
        <small id="emailHelp" class="form-text text-muted">
          이메일을 입력하세요.
        </small>
        <small class="invalid-feedback">이메일을 다시 입력하세요.</small>
        <small class="form-text text-danger" th:if="${#fields.hasErrors('email')}" th:errors="*{email}">Email Error</small>
      </div>

      <br>
      <div class="form-group">
        <button class="btn btn-outline-warning" type="submit" th:width="120px"
                aria-describedby="submitHelp">가입하기
        </button>
      </div>
    </form>
  </div>
</div>
</body>
</html>
```

<br/><br/>

![이미지](/programming/img/회원가입1.PNG)

<br/><br/>

## resources 폴더 → templates → members 패키지 → main.html

```html
<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments.html :: head"></head>
<body class="bg-white">
<div th:replace="fragments.html :: main-nav"></div>

 회원가입 후 페이지

</body>
</html>
```
