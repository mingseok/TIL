## 프록시 기초



JPA에서는 `em.find()` 기능도 있지만, `em.getReference()` 라는 기능도 있다.

- `em.find()` : 데이터베이스를 통해서 실제 엔티티 객체 조회한다.

- `em.getReference()` : 데이터베이스 조회를 미루는 가짜(프록시) 엔티티 객체 조회
    - 즉, 이건 DB에 쿼리가 나가지 않는데, 객체가 조회 되는 것이다.

<br/><br/>

## 프록시 특징

- 실제 클래스를 상속 받아서 만들어진다.

- 실제 클래스와 겉 모양이 같다.
- 사용하는 입장에서는 진짜 객체인지 프록시 객체인지 구분하지 않고 사용하면 됨(=이론상)

![이미지](/programming/img/입문368.PNG)

<br/>

- 프록시 객체는 실제 객체의 참조(target)를 보관한다.

- 프록시 객체를 호출하면 프록시 객체는 실제 객체의 메소드 호출한다.

![이미지](/programming/img/입문369.PNG)

<br/><br/>

## 프록시 객체의 초기화

```java
Member member = em.getReference(Member.class, “id1”);
member.getName();
```

<br/>

![이미지](/programming/img/입문370.PNG)

2번 설명) 프록시에 값이 없을때 DB를 통해서 “진짜 값을 달라!” 하는 것이다.

<br/><br/>

## 프록시의 중요 특징

- 프록시 객체는 처음 사용할 때 한 번만 초기화

- 프록시 객체를 초기화 할 때, 프록시 객체가 실제 엔티티로 바뀌는 것은 아니다
    - 초기화되면 프록시 객체를 통해서 실제 엔티티에 접근 가능한 것이지 프록시가 실제로 바뀌는 것이 아니다.
        
- 프록시 객체는 원본 엔티티를 상속 받는다
    - 따라서 타입 체크시 주의해야한다.  (“==” 비교 실패, 대신 “instance of” 사용해야 한다)

- 영속성 컨텍스트에 찾는 엔티티가 이미 있으면
    
    `em.getReference()`를 호출해도 실제 엔티티 반환 한다.
    
- (실무에서 많이 보는 에러) 영속성 컨텍스트의 도움을 받을 수 없는 준영속 상태일 때,
    
    프록시를 초기화하면 문제 발생 → `org.hibernate.LazyInitializationException` 예외 발생.


<br/><br/>

>**Reference** <br/>[자바 ORM 표준 JPA 프로그래밍 - 기본편](https://www.inflearn.com/course/ORM-JPA-Basic)

