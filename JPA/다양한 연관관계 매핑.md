## 연관관계 매핑시 고려사항 3가지

- 다중성

- 단방향, 양방향
- 연관관계의 주인

<br/>

## 다중성

- `다대일`: @ManyToOne → 가장 많이 사용

- `일대다`: @OneToMany → 그나마 많이 사용
- `일대일`: @OneToOne → 사용하기는 하는 정도
- `다대다`: @ManyToMany → 실무에서 사용하지 않는다.

<br/><br/>

## 단방향, 양방향

- 테이블
    - 외래키 하나로 양쪽 조인 가능

    - 사실 방향이라는 개념이 없음
- 객체
    - 참조용 필드가 있는 쪽으로만 참조 가능

    - 한쪽만 참조하면 단방향
    - 양쪽이 서로 참조하면 단방향 2개가 있는것이다 → 이걸 그냥 양방향이라고 함

<br/><br/>

## 연관관계의 주인

- 테이블은 외래 키 하나로 두 테이블이 연관관계를 맺음

- 객체 양방향 관계는 `A->B`, `B->A`처럼 참조가 2군데
- 객체 양방향 관계는 참조가 2군데 있음.
    - 둘중 테이블의 외래 키를 관리할 곳을 지정해야함
- 연관관계의 주인: 외래 키를 관리하는 참조
- 주인의 반대편: 외래 키에 영향을 주지 않음, 단순 조회만 가능

<br/><br/>

## 다대일 [ N : 1 ]

연관관계 주인은? → 먼저 나오는 “다” 가 주인이다.

<br/>

### 다대일 단방향

- 가장 많이 사용하는 연관관계이다.

무조건, `“다”` 에 외래키가 가야 되는 것이다. → 그러지 않으면 설계가 잘못된 것이다.

![이미지](/programming/img/입문355.PNG)

<br/><br/>

### 코드로 보면 이렇다.

이렇게 `Member`에서 `Team`으로 가는 방법이다.

```java
@Entity
public class Member {

    // 생략 ..

    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;

		// 생략 ..
}
```

<br/><br/>

### 다대일 양방향

반대쪽 사이드를 추가한다고 해서, 테이블에 영향을 전혀 주지 않는다.

- 연관관계 주인이 아니기 때문에, 읽기만 가능하기 때문이다.

![이미지](/programming/img/입문356.PNG)

<br/><br/>

## 일대다 [ 1 : N ]

연관관계 주인은? → 먼저 나오는 “일” 이 주인이다.

### 일대다 단방향

- 일대다 단방향은 일대다(1:N)에서 일(1)이 연관관계의 주인이다.

    - 엔티티 관리하는 외래키가 다른 테이블에 있다는게 엄청난 단점이다.

- 객체와 테이블의 차이 때문에 반대편 테이블의 외래키를 관리하는 특이한 구조이다.
- `@JoinColumn`을 꼭 사용해야 한다.

```
결론은, 잘 사용하지 않는 방법이다 -> '일대다' 방법보다는 '다대일' 양방향 매핑을 사용하자.
```

<br/>

### 일대다 양방향

- 이런 매핑은 공식적으로 존재하지 않는다.

- 다대일 양방향을 사용하자.

<br/><br/>

## 일대일 [ 1 : 1 ]

![이미지](/programming/img/입문357.PNG)

- 일대일 관계는 그 반대도 일대일이다.

- 주 테이블이나 대상 테이블 중에 외래키를 아무대나 넣어도 상관이 없다.
    - member나 team 아무대나 넣어도 상관이 없다는 뜻이다.

    - 이렇게 가능한 이유는 1 : 1 관계이기 때문
- 외래키에 데이터베이스 유니크 제약조건 추가해야 함.

<br/><br/>

### 코드 확인

```java
@Entity
public class Member {

    // 생략..

    @OneToOne
    @JoinColumn(name = "LOCKER_ID")
    private Locker locker;
}
```

```java
@Entity
public class Locker {
    
    @Id @GeneratedValue
    private Long id;
    private String name;
}
```

<br/>

### 일대일 정리

- 다대일`(@ManyToOne)` 단방향 매핑과 유사하다.

<br/><br/>

## 다대다 [ N : N ]

- 편리해 보이지만 실무에서 사용하면 안된다.
- 연결 테이블이 단순히 연결만 하고 끝나지 않는다.
- 주문시간, 수량 같은 데이터가 들어올 수가 있다.