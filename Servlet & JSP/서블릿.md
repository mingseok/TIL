# 서블릿 기초

서블릿은 jsp 표준이 나오기 전에 만들어진 표준으로 자바로 웹 어플리케이션을 개발할 수 있도록 하기 위해 만들어졌다. (html 내용을 자바 클래스에서) 서블릿을 이용하면 자바 클래스를 이용해서 웹 어플리케이션을 개발하게 된다.

![이미지](/programming/img/서블릿1.PNG)

서블릿 클래스를 구현하려면 먼저 HttpServlet 클래스를 상속받은 클래스를 작성해야 한다.

12행처럼 HttpServlet 클래스를 상속받아야 서블릿으로 동작한다.<br/><br/>

HttpServlet 클래스를 상속받았다면, 처리하고자 하는 HTTP 방식(method)에 따라 알맞은 메서드를 재정의해서 구현해야 한다. 예를 들어, 서블릿이 GET 방식의 요청을 처리해야 한다면, 15~16행과 같이 doGet( ) 메서드를 재정의하면 된다. doGet( ) 메서드는 HttpServletRequest와 HttpServletResponse의 두 파라미터를 갖는데, 이 두 파라미터는 각각 jsp request 기본 객체와 response 기본 객체에 해당한다.<br/><br/>

재정의한 메서드는 request를 이용해서 웹 브라우저의 요청 정보를 읽어오던가 response를 이용해서 응답을 전송할 수 있다. 응답을 전송하려면 먼저 17행과 같이 response.setContentType( ) 메서드를 이용해서 응답의 컨텐츠 타입을 지정해야 한다.<br/><br/>

응답의 컨텐츠 타입을 지정했다면, 그다음으로 할 작업은 실제로 응답 결과를 웹 브라우저에 전송하는 것이다. 웹 브라우저에 데이터를 전송하려면 19행과 같이 response.getWriter( )로 문자열 데이터를 출력할 수 있는 PrintWriter를 구해야 한다.<br/><br/>

PrintWriter는 println( ) 메서드를 제공하는데, 이 메서드를 이용해서 전송할 응답 데이터를 전달한다.

println( ) 메서드에 전달한 데이터는 웹 브라우저에 전송되어 화면에 출력 된다.<br/><br/>

## 서블릿 클래스를 생성 했다면, web.xml 파일에 서블릿 클래스를 등록하는 것이다.

![이미지](/programming/img/서블릿2.PNG)

서블릿을 등록하려면 다음의 두 가지를 설정해야 한다.

1. 서블릿으로 사용할 클래스
2. 서블릿과 URL 간의 매핑

먼저 8 ~ 11행과 같이 <servlet> 태그를 이용해서 서블릿 클래스를 등록한다.<br/><br/>

서블릿으로 사용할 클래스의 완전한 이름을 now라는 이름의 서블릿으로 등록한다.
<br/><br/>
그 다음으로는 할 작업은 해당 서블릿이 어떤 URL을 처리할지에 대한 매핑 정보를 등록 하는 것이다.
<br/><br/>
이는 <servlet-mapping> 태그를 이용해서 지정한다. <servlet-mapping> 태그에서 <servlet-name>은 매핑할 서블릿의 이름을 지정하며, <url-pattern>은 매핑할 URL의 패턴을 처리한다고 지정하고 있다. 예를 들어 14 ~ 17행의 경우 now라는 이름의 서블릿이 /now라는 URL 패턴을 사용하여 처리한다고 지정하고 있다. 앞서 8 ~11행에서 NowServlet 클래스를 now라는 이름의 서블릿으로 등록했으므로, 결과적으로 /now라는 URL을 example.NowServlet 클래스를 처리하게 된다.
<br/><br/><br/>
실제로 NowServlet이 정상적으로 동작하는지 확인하기 위해 톰캣을 실행하고 웹 브라우저에 [http://localhost:8080/chap17/now](http://localhost:8080/chap17/now) URL을 입력해 보자. 그러면 실행 되는걸 알 수 있을 것이다.

![이미지](/programming/img/서블릿3.PNG)

example.NowServlet 클래스만 작성 했다고 실행되지 않는다.<br/><br/>

## 어너테이션으로 매핑하기

서블릿 2.5 버전까지는 web.xml 파일에 서블릿으로 등록해야 서블릿 클래스를 사용할 수 있었는데, 서블릿 3.0 버전부터는 @WebServlet 어너테이션을 사용하면 web.xml 파일에 따로 등록하지 않아도 서블릿으로 등록이 된다.

![이미지](/programming/img/사진4.PNG)

@WebServlet 어너테이션은 urlPatterns 속성을 갖는데 이 속성은 해당 서블릿과 매핑될 URL 패턴을 지정할때 사용된다. 위 코드는 /hello로 들어오는 URL을 HelloServlet이 처리 하도록 설정하고 있다.<br/><br/>

만약 두개 이상의 URL 패턴을 처리하도록 하고 싶다면 다음과 같이 urlPatterns 속성값으로 배열을 전달 하면 된다.

```java
@WebServlet(urlPatterns = {"/hello", "/hi"} )
```

<br/><br/>실행시켜 보면 

톰캣이 chap17 웹 어플리케이션을 구동하면서 @WebServlet 어너테이션이 적용된 서블릿을 찾게 되므로, 사용할 서블릿으로 HelloServlet을 등록하게 된다. 따라서 web.xml 파일에 별도의 설정을 하지 않아도 [http://localhost:8090/chap17/hello](http://localhost:8090/chap17/hello) URL을 이용해서 HelloServlet을 실행 시킬 수 있게 되는 것이다.

![이미지](/programming/img/서블릿5.PNG)<br/><br/><br/>

@WebServlet 어너테이션을 사용할때 고려할 점은 서블릿이 여러 분야나 용도로 널리 사용 되는지의 여부이다. 예를 들어 MVC 프레임워크는 어떤 URL을 서블릿이 처리할지 미리 알 수가 없다.
<br/><br/><br/>
그리하여 서블릿의 용도에 따라서 @WebServlet 어너테이션을 사용할지 아니면 web.xml 설정을 사용할지를 알맞게 결정 해야 한다.

![이미지](/programming/img/서블릿6.PNG)

웹 브라우저에서 /now 경로로 접근하면 NowServlet을 실행하는데, 서블릿 컨테이너는 처음 서블릿을 실행할 때 서블릿 객체를 생성한다. 서블릿을 최초 요청할 때 서블릿 객체를 생성하고, 이후 요청이 오면 앞서 생성한 서블릿 객체를 그대로 사용한다.<br/><br/>

웹 컨테이너가 서블릿 객체를 생성하고 init( ) 메서드를 호출하는 과정을 ‘서블릿 로딩’ 과정이라고 한다. 서블릿 로딩 과정을 보면 init( ) 메서드를 호출하는데, 서블릿은 이 init( ) 메서드를 이용해서 필요한 초기화 작업을 수행 하는 것이다.<br/><br/>

서블릿 컨테이너는 서블릿을 초기화하기 위해 ServletConfig 파라미터를 갖는 init( ) 메서드를 실행한다.<br/><br/>

## URL 패턴 매핑 규칙

‘/’ 로 시작하고 ‘/*’로 끝나는 url-pattern은 경로 매핑을 위해서 사용한다.

‘*.’ 로 시작하는 url-pattern은 확장자에 대한 매핑을 할 때 사용한다.

오직 ‘/’만 포함하는 경우 어플리케이션의 기본 서블릿으로 매핑한다.<br/><br/><br/>

예를 들면 1-1

| URL 패턴 | 매핑 서블릿 |
| --- | --- |
| /foo/bar/* | servlet1 |
| /baz/* | servlet2 |
| /catalog | servlet3 |
| *.bop | servlet4 |


<br/><br/><br/>
1-2 이다
1-1 참조 하여 보기
| 실제 경로 | 일치 URL 패턴 | 요청 처리 서블릿 |
| --- | --- | --- |
| /foo/bar/index.html | /foo/bar/* | servlet1 |
| /foo/bar/index.bop | /foo/bar/* | servlet1 |
| /baz/ | /baz/* | servlet2 |
| /baz/index.html | /baz/* | servlet2 |
| /catalog | /catalog | servlet3 |
| /catalog/racecar.bop | *.bop | servlet4 |
| /index.bop | *.bop | servlet4 |