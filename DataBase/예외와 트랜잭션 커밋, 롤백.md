## 예외와 트랜잭션 커밋, 롤백

## 궁금증.

```
예외가 발생했는데, 내부에서 예외를 처리하지 못하고, 
트랜잭션 범위 밖으로 예외를 던지면 어떻게 될까?
```

<br/>

![이미지](/programming/img/입문270.PNG)

예외 발생시 스프링 트랜잭션 AOP는 예외의 종류에 따라 트랜잭션을 `커밋`하거나 `롤백`한다.

- 언체크 예외인 `RuntimeException`, `Error`와 그 하위 예외가 발생하면 트랜잭션을 `롤백`한다.

- 체크 예외인 `Exception`과 그 하위 예외가 발생하면 트랜잭션을 `커밋`한다.
- 물론 정상 응답(리턴)하면 트랜잭션을 커밋한다.

<br/><br/>

## 궁금증

```
스프링은 왜 체크 예외는 커밋하고, 언체크(런타임) 예외는 롤백할까?
```

스프링 기본적으로 `체크 예외`는 비즈니스 의미가 있을 때 사용하고, 

`런타임(언체크)` 예외는 복구 불가능한 예외로 가정한다.

- `체크 예외:` 비즈니스 의미가 있을 때 사용

- `언체크 예외:` 복구 불가능한 예외

<br/><br/>

## 비즈니스 예외라는 것이 무슨 뜻일까?

비즈니스 요구사항 주문을 하는데 상황에 따라 다음과 같이 조치한다.

1. `정상:` 주문 시 결제를 성공하면 주문 데이터를 저장하고 결제 상태를 완료로 처리한다.

2. `시스템 예외:` 주문 시 내부에 복구 불가능한 예외가 발생하면 전체 데이터를 롤백한다.
3. `비즈니스 예외:` 주문 시 결제 잔고가 부족하면 주문 데이터를 저장하고, 결제 상태를 대기로 처리한다.
    
    이 경우 고객에게 잔고 부족을 알리고 별도의 계좌로 입금하도록 안내한다.

<br/><br/>

## 비즈니스 예외(3번) 추가 설명

```
결제 잔고가 부족하면 시스템에 문제가 있어서 발생하는 시스템 예외가 아니다.
```

시스템은 정상 동작했지만, 비즈니스 상황에서 문제가 되기 때문에 발생한 예외이다.



고객의 잔고가 부족한 것은 시스템에 문제가 있는 것이 아니다. 

<br/>

오히려 시스템은 문제 없이 동작한 것이고, 비즈니스 상황이 예외인 것이다. 

이런 예외를 비즈니스 예외라 한다. 

<br/>

그리고 비즈니스 예외는 매우 중요하고, 반드시 처리해야 하는 경우가 많으므로 체크 예외를 고려할 수 있다.

<br/><br/>

>**Reference** <br/>[스프링 DB 2편 - 데이터 접근 활용 기술](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-db-2/dashboard)

