## 예외 처리 - 인터셉터 총 정리

### 이걸 보고 내가 정리해 놓은 것들 수정하자.

<br/>

## 예시를 들자면, 네이버 메인 화면에 들어왔다. 

현재 로그인이 되어 있지 않은 상황이다. 

이 상태에서 네이버 userA 블로그를 가려고 한다. 

(userA 블로그는 비로그인 상태에서도 볼 수 있다.)

<br/>그런데 여기서 필터(로그인 인증 필터)가 적용되어 있다면 ‘전체 블로그’ 를 클릭하면 

‘로그인’ 화면으로 이동 될 것이고, ‘상세 검색’ 페이지, 등등 이동 할때 마다 

‘로그인’ 화면으로 이동하게 될 것이다. 이건 너무나 클라이언트에게 불편한 것이다. 

<br/>그리하여 `excludePathPatterns()` 메서드를 사용하는 것이다. 

이걸 사용하면 “이 페이지들은 필터 적용 안한다!” 하고 명시 해주는 것이다 

이렇게 해야 비로그인 사용자가 userA까지 로그인 하라는 화면 넘어 가는거 없이 편하게 이용 할 수 있는 것이다.

<br/>

### `"/error-page/**"` 로 생각한다면

이건 `/error-page/**` 들을 제거 하는 것이 아니다. 

이때까지 내가 생각했던 이해는 `/error-page/**` 제거 하니깐 /error-page 디렉토리 안에 있는 

페이지들은 전부 출력이 안된다고 이해 하고 있었다. 이건 잘못 이해하고 있는 것이 였다.

앞으로는 이렇게 이해 하자.

<br/>

`excludePathPatterns(“/error-page/**")` 되어 있다면, 

이건 “/error-page/~~ 안에 있는 것들은 필터를 제외 시키겠다” 하는 것이다. 

즉, 밑에 정리 한것을 보면 4번 에서 필터(x) 부분이 있을 것이다. 

이 부분이 바로 “필터를 제외 시키겠다” 하는 부분인 것이다.

여기 강의에서는 어떻게 사용 하는지를 알려 주는 부분이라 필드에 대해 자세한게 없다.

<br/>만약 프로젝트를 할때나 그럴때면 필터 부분에 ‘로그인 인증 확인’ → 실패시 ‘로그인 화면’ 으로  

이런게 있을 것인데 그런게 없는 것이다. 

<br/>

## 결론은, `excludePathPatterns()` 메서드 안에 있는 것들은 필터 적용에서 뺀다!! <br/>만 알고 있으면 된다.

```
1. WAS(/error-ex, dispatchType=REQUEST) -> 필터 -> 서블릿 -> 인터셉터 -> 컨트롤러

2. WAS(여기까지 전파) <- 필터 <- 서블릿 <- 인터셉터 <- 컨트롤러(예외발생)

3. WAS 오류 페이지 찾으면(WebServerCustomizer 클래스에서) 확인 

4. WAS(/error-page/500, dispatchType=ERROR) -> 필터(x) -> 서블릿 -> 인터셉터(x) ->
컨트롤러(/error-page/500) -> View
```

<br/>

### 왜 바로 첫번째부터 적용이 안됐을까??

이건 클라이언트가 /error-ex 로 요청 했기 때문에 그런것이다.

이유는 WebServerCustomizer 클래스에서 RuntimeException.class 발생하면



"/error-page/500" 으로 가라! 라고 명시 해놨기 때문에 바로 필터 적용이 안된 것이다.

다시 말해,에러가 발생해야 "/error-page/500" 가라고 하는 로직이 발동 된다고 생각하면 된다.

<br/>

>**Reference** <br/>스프링 MVC 2편 - 백엔드 웹 개발 활용 기술 - https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-mvc-2