우리 모두를 합친 것보다 더 현명한 사람은 없다. - 켄 블랜차드

4장을 들어가게 된다면 바로 보게 되는 말입니다.

객체의 세계에서도 협력이라는 문맥이 객체의 행동방식을 결정한다.

문맥의 고려 없이 객체의 상태, 행동을 고민하면 안된다.

---

## 협력

제가 생각하는 협력의 큰 틀은 

**협력**은 다수의 **요청**과 **응답**으로 구성되며 

전체적으로 협력은 다수의 연쇄적인 요청과 응답의 흐름으로 구성된다고 볼 수 있습니다.

그리고 개별적인 객체가 아닌 객체들 간 협력에 집중하자!

### **재판 속의 협력**

이상한 나라의 앨리스에서의 협력을 간단하게 생각해보자면,

1. 누군가가 파이를 훔쳤다는 혐의를 받고 하트 잭에 대한 재판을 **`요청`**
함으로써 재판이 시작됩니다.
2. 재판을 하는 왕이 하얀 토끼에게 증인을 부를 것을 **`요청`**한다.
3. 왕의 요청을 받은 토끼는 모자 장수에게 증인석으로 입장할 것을 **`요청`**한다.
4. 모자 장수는 증인석에 입장함으로써 토끼의 요청에 **`응답`**한다.

이런식으로 등장인물들이 특정한 요청을 받아들일 수 있는 이유는

그 요청에 대해 적절한 방식으로 응답하는 데 필요한 지식과 행동 방식을 가지고 있기 때문 입니다.

그리고 요청과 응답은 협력에 참여하는 객체가 수행할 책임을 정의한다.

### 협력은 다른사람에게 요청하는 것 부터 시작

```java
왕 -> 목격자를 불러오라 -> 토끼 -> 증인석에 입장하라 -> 모자장수
```

협력에 참여하는 객체는 요청에 응답할 책임을 갖는다.

협력의 시작은 한 사람이 다른 사람에게 도움을 요청 할 때 시작 한다.

- 즉, 자신이 해결 할 수 없는 문제를 만났을 때라고도 말 할 수 있다.

그리고 이러한 협력은 다수의 연쇄적 요청과 응답의 흐름으로 구성된다고 알려주고 있습니다. 

(앨리스 상황으로 생각한다면, 재판 속의 협력을 말한다)

---

## 책임

객체지향의 세계에서는 어떤 객체가 어떤 요청에 대해 대답해 줄 수 있거나, 
적절한 행동을 할 의무가 있는 경우 해당 객체가 **책임**을 가진다고 말한다.

어떤 대상에 대한 요청은 그 대상이 요청을 처리할 책임이 있음을 암시한다.

- 즉, 토끼는 '목격자를 불러오라'는 요청에 응답해야 하므로 '목격자를 불러올' 책임을 진다.

- 적절한 행동을 할 의무가 있는 경우 해당 객체가 책임을 가진다고 말한다.
- 객체와 책임이 이리저리 부유하는 상황에서 변경에 취약한 비자율 적인 객체를 낳게 된다.
    
     (책임을 잘 분류하지 못한다면 여러 책임을 하나의 객체가 맡을 수 있다.)
    

### 책임을 분류

협력에 참여하는 객체들은 목표를 달성하는 데 필요한 책임을 수행한다.

객체의 책임은 '객체가 무엇을 알고 있는가'와 '무엇을 할 수 있는가'로 구성된다.

1. 하는 것
    - 객체를 생성하거나 계산을 하는 등의 스스로 하는 것
    - 다른 객체의 행동을 시작시키는 것
    - 다른 객체의 활동을 제어하고 조절하는 것
2. 아는 것
    - 개인적인 정보에 관해 아는 것
    - 관련된 객체에 관해 아는 것
    - 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

### 책임은 객체의 외부에 제공해 줄 수 있는 정보와 외부에 제공해 줄 수 있는 서비스의 목록

즉, 책임은 객체의 공용 인터페이스를 구성해야 한다는 것입니다.

책임과 메시지에 대한 대략적인 윤곽을 먼저 잡아라 라는 것이고,

해당 객체가 어떠한 요청에 대해 적절한 행동을 할 의무가 있는가 에 대해

고민을 해보면 되지 않을까 생각합니다.

### **책임과 메시지**

협력 안에서 객체는 다른 객체로부터 요청이 전송됐을 경우에만 자신에게 주어진 책임을 수행한다.

객체가 다른 객체에게 주어진 책임을 수행하도록 요청을 보내는 것을 **메시지 전송** 이라고 한다.

책임이 협력이라는 문맥 속에서 요청을 수신하는 한 쪽의 객체 관점에서 무엇을 할 수 있는지를 

나열하는 것이라면 메시지는 협력에 참여하는 두 객체 사이의 관계를 강조한 것이다.

앞에서 다뤘던 메세지의 책임을 같은 것으로 바라보면 안된다.

메세지 책임의 관계로 책임이 좀 더 상위 수준의 추상화된 것이고 메세지는 이러한 

책임의 일부에 속한다고 봐야 할 것 같다.

### 주의할 점은 책임과 메시지의 수준이 같지는 않다는 점이다.

- 책임은 객체가 협력에 참여하기 위해 수행해야 하는 행위를 상위 수준에서 개략적으로 서술한 것이다.
- 협력을 정제하면서 책임이 메시지로 변환할 때는 하나의 책임이 여러 메시지로 분할되는 것이 일반적이다.

## 역할

재판에서 `증인석에 입장한다`와 `증언하다`라는 모자장수의 `책임`은 증인으로서

의 `역할`을 수행하고 있음을 알수 있고,

`재판하다`라는 왕의 `책임`은 판사라는 `역할`을 수행하고 있음을 알 수 있다.

### **책임의 집합이 의미하는 것**

어떤 객체가 수행하는 책임의 집합은 객체가 협력 안에서 수행하는 역할을 암시한다.

- 앨리스를 생각해보자면, 왕은 '판사'라는 역할을 수행하고 있고 모자 장수는 '증인'이라는 역할을 수행하고 있음을 의미 합니다.

굳이 왕을 판사라고 부르고 모자 장수를 증인이라고 불러서 상황을 복잡하게 만드는 이유는 무엇인가?

- 역할이 재사용 가능하고 유연한 객체지향 설계를 낳는 매우 중요한 구성요소이기 때문이다.

### **판사와 증인**

이상한 나라의 앨리스를 간단하게 생각해보자면,

- 모자 장수에 이어 요리사와 앨리스가 재판의 증인으로 출석했다.
- 판사로서 재판을 주관하던 왕이 앨리스가 증인으로 채택된 시점에 여왕에게 자신의 일을 위임했다.

모자 장수, 요리사, 앨리스가 증인으로 참석하는 재판 과정은 전체적으로 그 흐름이 매우 유사하다.

차이점이라고는 왕 대신 여왕이, 모자 장수 대신 요리사나 앨리스가 협력에 참여한다는 것뿐이다.

### **역할이 답이다.**

재판에서 왕-토끼-모자 장수, 왕-토끼-요리사, 여왕-토끼-앨리스라는 세 개의 협력이 주어져 있다.

협력에 참여하는 등장인물들을 제외한 나머지 과정이 너무나도 유사해서 하나의 협력으로 다루고 싶다는 것입니다.

판사와 증인이라는 **역할**을 사용하면 세 가지 협력을 모두 포괄할 수 있는 하나의 협력으로 추상화할 수 있다.

- 누군가가 **`판사`**에게 재판을 요청함으로써 재판이 시작된다.
- **`판사`**가 하얀 토끼에게 증인을 부를 것을 요청한다.
- **`판사`**의 요청을 받은 토끼는 **`증인`**에게 증인석으로 입장할 것을 요청한다.
- **`증인`**은 증인석에 입장함으로써 토끼의 요청에 응답한다.
- **증인**의 입장은 연쇄적으로 토끼에 대한 **`판사`**의 요청에 대한 응답이기도 하다.
- 이제 **`판사`**는 **`증인`**에게 증언할 것을 요청한다.
- **`증인`**은 자신이 알고 있는 내용을 증언함으로써 **`판사`**의 요청에 응답한다.

즉, 협력 안에서 역할은 **"이 자리는 해당 역할을 수행할 수 있는 어떤 객체라도 대신할 수 있습니다"** 라고 말하는 것과 같습니다.

- 예로, 판사 역할은 하트 왕과 하트 여왕이 대신할 수 있고
- 증인 역할은 모자 장수, 요리사, 앨리스가 대신할 수 있습니다.

하지만 역할을 대체할 수 있는 객체는 동일한 메시지를 이해할 수 있는 객체로 한정된다.

- 동일한 역할을 수행할 수 있다는 것은 해당 객체들이 협력 내에서 동일한 책임의 집합을 수행할 수 있다는 것을 의미한다.

### 정리하자면,

- 역할의 개념을 사용하면 유사한 **협력을 추상화** 해서 인지 과부하를 줄일 수 있다고 합니다.
- 또한 다양한 객체들이 협력에 참여할 수 있기 때문에 협력이 좀 더 유연해지며 다양한 객체들이 동일한 협력에 참여할 수 있기 때문에 재사용성이 높이고 있습니다.
- 역할은 객체지향 설계의 단순성, 유연성, 재사용성을 뒷받침하는 핵심 개념이다.

### **대체 가능성**

객체가 역할에 주어진 책임 이외에 다른 책임을 수행할 수도 있다.

- 모자 장수는 증인으로서의 역할뿐만 아니라 모자를 판매할 모자 장수로서의 책임을 가지고 있다.
- 객체는 역할이 암시하는 책임보다 더 많은 책임을 가질 수 있다.

따라서 대부분의 경우에 객체의 타입과 역할 사이에는 **일반화/특수화 관계**가 성립하는 것이 일반적이다.

- 좀 더 일반적인 개념을 의미하는 역할은 일반화인 것이고,
- 좀 더 구체적인 개념을 의미하는 객체의 타입은 특수화인 것입니다.

역할의 대체 가능성은 행위 호환성을 의미하고, 행위 호환성은 동일한 책임의 수행을 의미한다.

## **객체의 모양을 결정하는 협력**

### **협력을 따라 흐르는 객체의 책임**

협력을 설계한다는 것은 설계에 참여하는 객체들이 주고받을 요청과 응답의 흐름을 결정한다는 것을 의미한다.

- 즉, 결정된 요청과 응답의 흐름은 객체가 협력에 참여하기 위해 수행될 책임이 된다.

객체에게 책임을 할당하고 나면 책임은 객체가 외부에 제공하게 될 행동이 된다.

- 행동을 결정한 후에 그 행동을 수행하는 데 필요한 데이터를 고민해야 한다.
- 행동과 데이터가 어느 정도 결정된 후에 클래스의 구현 방법을 결정해야 한다.

### 객체지향 설계 기법은 !!

객체지향 설계의 핵심은 올바른 책임을 올바른 객체에게 할당하는 것이다.

## **책임-주도 설계**

### **책임-주도 설계**

**책임-주도 설계** 방법은 협력에 필요한 책임들을 식별하고 적합한 객체에게 책임을 할당하는 방식으로 애플리케이션을 설계하는 느낌 같습니다.

- 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악한다.
- 시스템 책임을 더 작은 책임으로 분할한다.
- 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다.
- 객체가 책임을 수행하는 중에 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
- 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 된다.

결국 제가 생각하는 것은, 역할, 책임, 협력은 유연하고 견고한 객체지향 시스템을 만드는 데 필요한 가장 중요한 것이라고 알려고 있는 것 같습니다.

### **디자인 패턴**

**디자인 패턴**은 전문가들이 반복적으로 사용하는 해결 방법을 정의해 놓은 설계(역할, 책임, 협력) 템플릿의 모음이다.

- 디자인 패턴은 책임-주도 설계의 결과를 표현한다.
- 패턴은 반복해서 일어나는 특정한 상황에서 어떤 설계가 왜 더 효과적인지에 대한 이유를 설명한다.

만약 특정한 상황에 적용 가능한 디자인 패턴을 잘 알고 있다면 책임-주도 설계의 절차를 

순차적으로 따르지 않고도 시스템 안에 구현할 객체들의 역할과 책임, 협력 관계를 빠르고 

손쉽게 포착할 수 있을 것이라고 알려주고 있습니다.

그리고 디자인 패턴은 책임-주도 설계의 결과물인 동시에 지름길이라고 한다.

### **테스트-주도 개발**

**테스트-주도 개발**은 테스트를 먼저 작성하고 테스트를 통과하는 구체적인 코드를 추가하면서 애플리케이션을 완성해가는 방식이다.

- 이름에서 풍기는 뉘앙스와 달리 테스트가 아니라 설계를 위한 기법이다.
- 실제 목적은 구체적인 코드를 작성해나가면서 역할, 책임, 협력을 식별하고 식별된 역할, 책임, 협력이 적합한지를 피드백받는 것이다.

테스트-주도 개발은 테스트를 작성하는 것이 아니라 

책임을 수행할 객체 또는 클라이언트가 기대하는 객체의 역할이 

메시지를 수신할 때 어떤 결과를 반환하고 

그 과정에서 어떤 객체와 협력할 것인지에 대한 

기대를 코드의 형태로 작성하는 것이다.

테스트-주도 개발은 책임-주도 설계를 통해 도달해야 하는 

목적지를 테스트라는 안전장치를 통해 좀 더 빠르게 견고한 방법으로 

도달할 수 있도록 해주는 최상의 설계 프랙티스다.

## 질문

- pg 109. "조화를 이루며 적극적으로 상호작용하는 ~ 겉모습이 다소 기묘하고 비합리적이라도 말이다."
    - 객체를 보았을때 어떤 역할이고 어떤 책임을 갖는지 합리적으로 식별할 수 있다는게
        
        좋은 것이 아닌가요..?
        
- pg 119. 2번째 문단
    - 구현전에 도메인 설계 먼저 하라 라는 의미로 생각했음.

### **객체지향 설계 기법**

- **책임주도 설계**에서 도움 받을 객체를 찾고 나서
- 해당 객체 또는 역할 에게 책임을 할당한다는 의미가
- 객체를 찾고 나서 책임을 부여한다는 의미일까요.. 아니면,
- 해당 책음을 가진 객체 또는 역할을 찾는 것 인가요???