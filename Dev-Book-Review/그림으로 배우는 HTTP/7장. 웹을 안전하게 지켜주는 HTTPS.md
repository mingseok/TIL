## 7장. 웹을 안전하게 지켜주는 HTTPS

## HTTP의 약점

- 평문(암호화 하지 않은) 통신이기 때문에 도청이 가능
- 통신 상대를 확인하지 않기 때문에 위장 가능
- 완전성을 증명할 수 없기 때문에 변조 가능

<br/><br/>

## 평문이기 때문에 도청 가능

HTTP 자신을 암호화하는 기능은 없기 때문에 통신 전체가 암호화 되지는 않는다.

즉, 평문(암호화 되지 않은 메시지)으로  HTTP 메시지를 보내게 된다.

<br/>

### TCP/IP는 도청 가능한 네트워크

TCP/IP의 구조의 통신 내용은 전부 통신 경로 도중에 엿볼 수 있다.

<br/>

### 통신 내용을 엿볼 수 있다는 것은?

암호화된 통신에서도 암호화되지 않은 통신도 같다.

암호화 통신은 메시지 속의 의미는 간파할 수 없을 수도 있겠지만 암호화된 메시지 자체는 엿볼 수 있다.

```java
네트워크 상을 흐르고 있는 패킷을 수집하는 것만으로 도청할 수 있게 된다.
```

<br/><br/>

## 통신 암호화

HTTP에는 암호화 구조는 없지만 SSL이나 TLS이라는 다른 프로토콜을 조합함으로써 HTTP의 통신 내용을 암호화 할 수 있다.

SSL 등을 이용해 안전한 통신로를 확립하고 나서 그 통신로를 사용해 HTTP통신을 합니다.

```java
SSL을 조합한 HTTP를 HTTPS나 HTTP over SSL 라고 불리고 있다.
```

<br/><br/>

## 콘텐츠 암호화

통신하고 있는 콘텐츠의 내용 자체를 암호화해 버리는 방법이다.

HTTP에 암호화를 하는 기능은 없기 때문에 HTTP를 사용해서 운반하는 내용을 암호화 하는 것이다.

```java
즉, HTTP 메시지에 포함되는 콘텐츠만 암호화 하는 것이다.
```

<br/>

### 통신 상대를 확인하지 않기 때문에 위장 가능

HTTP를 사용한 리퀘스트나 리스폰스에서는 통신 상대를 확인하지 않는다.

<br/><br/>

## 누구나 리퀘스트할 수 있다

HTTP에 의한 통신에는 상대가 누구인지 확인하는 처리는 없기 때문에 누구든지 리퀘스트를 보낼 수 있다. 

또한, 리퀘스트가 오면 상대가 누구든지 무언가의 리스폰스를 반환한다.

<br/><br/>

## 상대를 확인하는 증명서

HTTP에서는 통신 상대를 확인할 수 없지만 SSL로 상대를 확인할 수 있다.

SSL은 암호화뿐만 아니라 상대를 확인하는 수단으로 증명서를 제공하고 있다.

<br/>

증명서는 신뢰할 수 있는 제3자 기관에 의해 발행되는 것이기 때문에 서버나 클라이언트가 실재하는 사실을 증명한다.

```java
증명서를 이용함으로써, 통신 상대가 내가 통신하고자 하는 서버임을 나타내고, 
이용자는 개인 정보 누설 등의 위험성이 줄어들게 된다.
```

또한, 클라이언트 가 증명서를 가짐으로써 본인 확인을 하고, 웹 사이트 인증에서 이용할 수 있다.

<br/>

### 완전성을 증명할 수 없기 때문에 변조 가능

완전성이란 정보의 정확성을 가리킨다.

그것을 증명할 수 없다는 것은 정보가 정확한지 아닌지를 확인할 수 없음을 의미한다.

<br/>

### 수신한 내용이 다를지도 모른다.

발신된 리퀘스트나 리스폰스와 수신한 리퀘스트나 리스폰스가 같은지 아닌지를 확인할 수 없다는 의미이다. 

콘텐츠가 도중에 다른 내용으로 변경되었을지도 모른다.

```java
예를 들어,
어떤 웹 사이트에서 콘텐츠를 다운로드 했다고 하면 클라이언트에 다운로드한 파일과 서버 상에
있는 파일이 정말로 같은 것인지 아닌지 모른다는 것이다.
```

이와 같이 공격자가 도중에 리퀘스트나 리스폰스를 빼앗아 변조하는 공격을 중간자 공격이라고 부른다.

<br/><br/>

## HTTP + 암호화 + 인증 + 완전성 보호 = HTTPS

HTTPS 가 나오기 전의 문제점

```java
1. HTTP통신은 암호화되지 않은 평문으로 실시된다.
   - 웹 페이지에서 신용 카드 번호를 입력 했을 때 도청되면 신용 카드 번호를 도청 당하게 된다.
2. HTTP에는 통신 상대의 서버나 클라이언트를 인증하는 수단이 없다.
3. 수신한 메시지가 도중에 변조되어 있을 가능성도 생각할 수 있다.
```

<br/>

이러한 문제를 해결 하기 위해서는 암호화와 인증과 완전성 보호 같은 구조를 HTTP에 추가할 필요가 있다.

HTTP에 암호화나 인증 등의 구조를 더한 것을 HTTPS 라고 부른다.

```java
HTTPS를 사용하는 통신은 웹 페이지의 로그인이나 쇼핑의 결제 화면 등에서 사용된다.
```

<br/><br/>

## HTTPS는 SSL의 껍질을 덮어쓴 HTTP

HTTPS는 새로운 애플리케이션 계층의 프로토콜은 아니다.

HTTP  통신을 하는 소켓 부분을 SSL이나 TLS이라는 프로토콜로 대처하고 있다.

<br/>

보통 HTTP는 직접 TCP와 통신하지만 SSL을 사용한 경우에는 HTTP는  SSL와 통신하고 SSL이 TCP와 통신하게 된다. 

즉, SSL이라는 껍질을 덮어 쓴 HTTP가 HTTPS 라고 보면 된다.

<br/><br/>

## 상호간에 키를 교환하는 공개키 암호화 방식

SSL에서는 공개키 암호화 방식이라 불리는 암호화 방식을 채용하고 있다.

현대의 암호는 알고리즘이 공개되어 있고 키를 비밀에 부침으로써 안전성을 유지한다.

<br/>

암호화나 복호화할 때 이 키를 사용한다.

공격자가 키를 알게 되면 암호화가 의미를 잃어버리게 된다.

<br/><br/>

## 두 개의 키를 사용하는 공개키 암호

공개키 암호에서는 서로 다른 두개의 키 페어(쌍)를 사용한다.

한쪽은 비밀키라 부르고 다른 한쪽은 공개키 라고 부른다.

비밀키는 누구에게도 알려지면 안되는 키이며 공개키는 누구에게나 알려져도 괜찮은 키이다.

<br/><br/>

## HTTPS는 하이브리드 암호 시스템

공개키 암호는 공통키 암호에 비해서 처리 속도가 늦다.

키를 교환하는 곳에서는 공개키 암호를 사용하고 그 후의 통신에서 메시지를 교환하는 곳에서는 공통키 암호를 사용한다.

<br/><br/>

## 공개키가 정확한지 아닌지를 증명하는 증명서

그 문제점은 공개키가 진짜인지 아닌지를 증명할 수 없다는 것이다.

```java
예를 들어,
어떤 서버와 공개키 암호를 사용해서 통신을 시작하려 할 때 수신한 공개키가 본래 의도한 서버가
발행한 공개키인지를 어떻게 증명할 수 있을까? 도중에 공격자가 공개키를 바꿔치기 했을지도 모른다.
```

<br/>

이 문제를 해결하기 위해

인증 기관과 그 기관이 발행하는 공개키 증명서가 이용되고 있다.

인증 기관이란 클라이언트와 서버가 모두 신뢰하는 제3자 기관이다.

<br/><br/>

## 인증 기관 이용 절차

1. 먼저 서버의 운영자가 인증 기관에 공개키를 제출한다.
2. 인증 기관은 제출된 공개키에 디지털 서명을 하고 서명이 끝난 공개키를 만든다.
3. 그리고 공개키 인증서에 서명이 끝난 공개키를 담는다.
4. 서버는 이 인증 기관에 의해서 작성된 공개키 인증서를 클라이언트에 보내고 공개키 암호로 통신한다. 

    (=공개키 인증서는 디지털 증명서나 줄여서 증명서라고 부른다.)
5. 증명서를 받은 클라이언트는 증명 기관의 공개키를 사용해서 서버의 공개키를 인증한 것이 

    진짜 인증 기관이라는 것과 서버의 공개키가 신뢰할 수 있다는 것을 알 수 있다.

<br/><br/>

## 조직의 실제성을 증명하는 EV SSL 증명서

증명서의 역할은 서버가 올바른 통신 상대임을 증명하는 것이지만,

상대방이 실제로 있는 기업인지를 확인하는 역할도 있다.

이러한 역할을 가진 증명서를 EV SSL 증명서라고 한다.

<br/><br/>

## 클라이언트를 확인하는 클라이언트 증명서

HTTPS에서는 클라이언트 증명서도 이용할 수 있다.

하지만, 클라이언트 인증은 그 만큼 비용을 들일 필요가 있는 곳에서만 사용되고 있다.

```java
예를 들면,
은행 인터넷 뱅킹에서 사용되는 경우가 있다.
로그인할 때 ID나 패스워드로 본인 확인을 할 뿐만 아니라 클라이언트 증명서를 요구하여 특정
단말기에 액세스하는지 아닌지 확인할 수 있다.
```

<br/>

그런데, 또 다른 문제점이 있다.

클라이언트 증명서가 들어간 컴퓨터를 사용할 권한이 있다면 누구든지 클라이언트 증명서를 이용할수 있다는 점이다.

<br/><br/>

## 왜 항상 HTTPS를 사용하지 않는가?

이유는, 평문 통신에 비해서 암호화 통신은 CPU나 메모리 등 리소스가 많이 필요하기 때문이다.

통신할 때마다 암호화를 하면 많은 리소스를 소비하기 때문에 그 결과 한 대당 처리할 수 있는 리퀘스트의 수가 줄어들게 된다. 

<br/>

그렇기 때문에 민감한 정보를 포함하지 않는 통신에서는 HTTP를 사용하고 개인 정보 등 

민감한 정보를 다룰 때만 HTTPS에 의한 암호화 통신을 사용한다.

<br/><br/>

>**Reference** 
> <br/> [
그림으로 배우는 HTTP & Network](http://www.yes24.com/Product/Goods/15894097)


