## 검증 헤더와 조건부 요청

<br/>

## 캐시 시간 초과

캐시 유효 시간이 초과해서 서버에 다시 요청하면 다음 두 가지 상황이 발생한다.

1. 서버에서 기존 데이터를 변경한다.

2. 서버에서 기존 데이터를 변경하지 않는다.

<br/><br/>

## 데이터를 변경하지 않을 경우.

![이미지](/programming/img/입문632.PNG)

내 브라우저에 있는 데이터가 변경 되었는지를 물어보기 위해 서버로 `(데이터 최종 수정일)`을 보낸다.

<br/><br/>

![이미지](/programming/img/입문633.PNG)

<br/><br/>

### 날짜를 가지고 검증을 하는 것이다.

![이미지](/programming/img/입문634.PNG)

<br/><br/>

![이미지](/programming/img/입문635.PNG)

무슨말이냐? `“웹브라우저야, 니가 요청했는데 현재 내쪽에서 변경된게 없어”` 말하는 것이다.

- 그리고 Last-Modified 메시지를 다시 내보내는 것이다.

- 중요한 것은 `http 바디`가 없는 것이다.

<br/><br/>

![이미지](/programming/img/입문636.PNG)

- 그리하여, 서버에서 → 웹 브라우저로 HTTP 바디가 없는 상태로 보낸다.
- 웹 브라우저가 `“304 Not Modified가 왔네”`,
    
    `“이거는 이 캐시가 변하지 않았으니 써도 되는 구나”` 라고 생각하는 것이다. 
    
- 그다음 캐시 컨트롤 값 갱신하고 다시 사용하게 되는 것이다.


<br/><br/>

## 그리하여, 이렇게 사용 되는 것이다.

![이미지](/programming/img/입문637.PNG)

<br/><br/>

## 정리

- 캐시 유효 시간이 초과해도, 서버의 데이터가 갱신되지 않으면

- 304 Not Modified + 헤더 메타 정보만 응답한다 (바디X)

- 클라이언트는 서버가 보낸 응답 헤더 정보로 캐시의 메타 정보를 갱신한다.

- 클라이언트는 캐시에 저장되어 있는 데이터를 재활용 한다.

- 결과적으로 네트워크 다운로드가 발생하지만 용량이 적은 헤더 정보만 다운로드 한다.

- 매우 실용적인 해결책이다.

<br/><br/>

## 검증 헤더와 조건부 요청 - Modified 단점

`Last-Modified`, `If-Moditied-Since` 단점이 있다.

- 1초 미만 단위로 캐시 조정이 불가능하다.

- 날짜 기반의 로직 사용

- 데이터를 수정해서 날짜가 다르지만, 같은 데이터를 수정해서 데이터 결과가 똑같은 경우

- 서버에서 별도의 캐시 로직을 관리하고 싶은 경우

    - e.g.) 스페이스나 주석처럼 크게 영향이 없는 변경에서 캐시를 유지하고 싶은 경우.

<br/><br/>

## 다른 방식인 **`etag` 방법!!**

- ETag(=Entity Tag)

- 캐시용 데이터에 임의의 고유한 버전 이름을 달아둔다.

    - e.g.) ETag : `“v1.0”`, ETag : `“a2jiodwo”` 등

- 데이터가 변경되면 이 이름을 바꿔서 변경한다.

    - e.g.) ETag : `“aaaa”` → ETag : `“bbbb”`

- 진짜 단순하게 ETag만 보내서 같으면 유지, 다르면 다시 받기 하는 것이다.

![이미지](/programming/img/입문638.PNG)

<br/><br/>

![이미지](/programming/img/입문639.PNG)

<br/><br/>

![이미지](/programming/img/입문640.PNG)

<br/><br/>

![이미지](/programming/img/입문641.PNG)

<br/><br/>

![이미지](/programming/img/입문642.PNG)

<br/><br/>

![이미지](/programming/img/입문643.PNG)

<br/><br/>

![이미지](/programming/img/입문644.PNG)

<br/><br/>

## 검증 헤더와 조건부 요청 - 정리

`ETag`, `If-None-Match` 정리

- 진짜 단순하게 ETag만 서버에 보내서 같으면 유지, 다르면 다시 받는다.

- 캐시 제어 로직을 서버에서 완전히 관리

- 클라이언트는 단순히 이 값을 서버에 제공

- e.g.

    - 서버는 배타 오픈 기간인 3일 동안 파일이 변경되어도 ETag를 동일하게 유지
    
    - 애플리케이션 배포 주기에 맞추어 ETag 모두 갱신