## Stateful, Stateless

무상태 프로토콜 : 스테이스리스 라고 부른다.

<br/>

## Stateful : 상태를 유지한다.

e.g.) 아무 이상이 없는 대화이다.

```java
고객: 이 노트북 얼마인가요?
점원: 100만원 입니다.

고객: 2개 구매하겠습니다.
점원: 200만원 입니다. 신용카드, 현금중에 어떤 걸로 구매 하시겠나요?

고객: 신용카드로 구매하겠습니다.
점원: 200만원 결제 완료 되었습니다.
```

<br/>

## 하지만 이 대화를 보면 다르다.

```java
고객: 이 노트북 얼마인가요?
점원: 100만원 입니다.

고객: 2개 구매하겠습니다.
점원: "?" 무엇을 2개 구매 하시겠어요?

고객: 신용카드로 구매하겠습니다.
점원: "?" 무슨 제품을 몇개 신용카드로 구매하시겠어요?
```

<br/>

## 즉, 다른점은

점원은 노트북의 상태를 유지하고 있는 것이다.

다시 말해, 서버가 클라이언트의 이전 상태를 보존 하는 것이다. → `“상태 유지"`

<br/><br/>

## Stateless : 상태를 유지하지 않는다. (무상태)

```java
고객: 이 노트북 얼마인가요?
점원: 100만원 입니다.

고객: 2개 구매하겠습니다.
점원: 200만원 입니다. 신용카드, 현금중에 어떤 걸로 구매 하시겠나요?

고객: 신용카드로 구매하겠습니다.
점원: 200만원 결제 완료 되었습니다.
```

즉, `상태 유지`에서는 `점원`이 바뀌면 `장애`가 나는 것이다.

하지만 무상태에서는 고객이 필요한 데이터를 그때그때 다 보내는 것이다.

- 때문에, 중간에 점원이 바뀌어도 아무 문제 없는 것이다.

<br/><br/>

## 정리하면

- `상태 유지:` 중간에 다른 점원으로 바뀌면 안된다.

    - 중간에 다른 점원으로 바뀔 때 상태 정보를 다른 점원에게 미리 알려줘야 한다

- `무상태:` 중간에 다른 점원으로 바뀌어도 된다.

    - 갑자기 고객이 증가해도 점원을 대거 투입할 수 있다.

    - 갑자기 클라이언트 요청이 증가해도 서버를 대거 투입할 수 있다.

    - 무상태는 응답 서버를 쉽게 바꿀 수 있다. → 무한한 서버 증설 가능

<br/>

### 상태 유지 - 그림으로 표현

![이미지](/programming/img/입문582.PNG)

<br/><br/>


## 만약 중간에 서버가 장애가 난다면?

클라이언트는 처음부터 다시 해야 되는 문제가 있다.

![이미지](/programming/img/입문583.PNG)

<br/>

### 무상태 - 그림으로 표현

`무상태`는 클라이언트가 요청할 때 부터 필요한 데이터를 다 담아서 보내는 것이다.

![이미지](/programming/img/입문584.PNG)

<br/><br/>


## 만약 무상태에서 중간에 서버가 장애가 난다면?


중계서버에서 서버1이 안되니 다시 `서버2로 던져 주는 것이다.`

![이미지](/programming/img/입문585.PNG)

<br/><br/>

## 실무에서의 한계

- 모든 것을 무상태로 설계 할 수 있는 경우도 있고 없는 경우도 있다.

    - 무상태: 로그인이 필요 없는 단순한 서비스 소개 화면

    - 상태 유지: 로그인

- 로그인한 사용자의 경우 로그인 했다는 상태를 서버에 유지

- 일반적으로 브라우저 쿠키와 서버 세션등을 사용해서 상태를 유지한다.

- 상태 유지는 최소한만 사용한다.

```java
"스테이리스를 기억하자"
서버 개발자들이 어려워하는 업무.

- 정말 같은 시간에 딱 맞추어 발생하는 대용량 트래픽
- 선착순 이벤트, 명정 KTX 예약, 학과 수업 등록
- 저녁 6시에 선착순 1000명 치킨 할인 이벤트 -> 수만명 동시 요청
```