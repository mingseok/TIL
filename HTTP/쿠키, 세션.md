## 쿠키, 세션

<br/>

## 쿠키

- Set-Cookie : 서버에서 클라이언트로 쿠키 전달 (응답)

- Cookie : 클라이언트가 서버에서 받은 쿠키를 저장하고, http 요청시 서버로 전달한다.

<br/><br/>

## 쿠키 사용하지 않을 경우.

사용자가 로그인을 하지 않았다.

![이미지](/programming/img/입문621.PNG)

<br/><br/>

사용자가 로그인을 했다.

![이미지](/programming/img/입문622.PNG)

<br/><br/>

### 로그인 한 상태에서 창을 닫았다가 다시 welcom 페이지로 들어간다면?

![이미지](/programming/img/입문623.PNG)

방금 로그인을 하여 ‘홍길동’을 기대 했는데, 로그인 하지 않은 `‘손님’`을 주는 것이다.

- 웹브라우저에서 `GET /welcom HTTP/1.1` 만 서버로 넘어온 것이다.

```java
"이유는 무상태 프로토콜(=Stateless)이기 때문에 그런것이다"
 -> 서로 상태를 유지하지 않기 때문에 그런것.
```

<br/><br/>

## Stateless란 무엇인가?

- HTTP는 무상태 프로토콜이다.

- 클라이언트와 서버가 요청과 응답을 주고 받으면 연결이 끊어진다.

- 클라이언트가 다시 요청하면 서버는 이전 요청을 기억하지 못한다.

- 클라이언트와 서버는 서로 상태를 유지하지 않는다.

<br/><br/>

## 쿠키를 도입한다면

![이미지](/programming/img/입문624.PNG)

1. 서버 입장에서는 로그인이 성공하면 쿠키를 만드는 것이다.

2. 내 웹 브라우저 내부에는 쿠키 저장소라는 곳이 있다.

3. user=홍길동 이라는 것을 저장을 해둔다.

<br/><br/>

![이미지](/programming/img/입문625.PNG)

로그인 이후에 사용자가 /welcome 페이지를 닫고 다시 /welcome 페이지로 들어간다.

그러면 자동으로 내 웹브라우저는 쿠키값을 무조건 http 헤더에 넣어서 서버에게 보내는 것이다.

<br/><br/>

### 쿠키는 모든 요청에 쿠키 정보를 자동 포함한다.

![이미지](/programming/img/입문626.PNG)

<br/><br/>

## 세선 + 쿠키 함께 사용 (= 사용자 로그인 세션 관리)

처음에 user=홍길동 으로 들어가서 서버한테서 쿠키를 받고, 

그 쿠키를 바로 웹브라우저에 저장하는 것은 엄청 위험하다. 

```java
"이유는. 홍길동의 정보들이 다 노출되기 때문이다"
```

<br/>

그리하여 처음에 서버쪽에서 로그인이 성공 되면, 세션 키라는 것을 서버에서 만들어서 

서버쪽 데이터 베이스에 저장을 해놓고, 다시 클라이언트에게 전달 할때는

`‘user=홍길동’`을 `‘세션id=값’` 으로 클라이언트에게 반환을 해주는 것이다.

<br/>

그러면 클라이언트는 그 사이트 요청을 보낼 때 마다 
 내 브라우저에서 ‘세션id=값’ 을 계속 보내는 것이다. 

```java
그러면 서버쪽에서 세션 id가 있으면 "아, 니가 홍길동이구나" 알 수 있게 되는 것이다
```

세션 키는 이 세션의 기간 동안 일시적으로 사용할 `'키'` 입니다. 

- 이, 키로 암호화와 복호화를 진행하게 됩니다.

<br/><br/>

## 쿠키는 브라우저(클라이언트), 세션은 서버에서 관리하는 정보

- 사용처

    - 사용자 로그인 세션 관리

    - 광고 정보 트래킹

- 쿠키 정보는 항상 서버에 전송된다.

    - 네트워크 트래픽 추가 유발

    - 최소한의 정보만 사용(세션 id, 인증 토큰)

    - 서버에 전송하지 않고, 웹 브라우저 내부에 데이터를 저장하고 싶다면 웹 스토리지

- 주의!

    - 보안에 민감한 데이터는 저장하면 안된다. (주민번호, 신용카드 번호 등등)

<br/><br/>

## 쿠키 - 생명주기

만료일이 되면 쿠키 삭제

- `세션 쿠키` : 만료 날짜를 생략하면 브라우저 종료시 까지만 유지

    - 단순히 웹 브라우저 종료시 클라이언트에서 종료 된다.

- `영속 쿠키` : 만료 날짜를 입력하면 해당 날짜까지 유지

    - 웹 브라우저가 종료되어도 클라이언트 시간이 남아 있는 한 살아남아 있다.

```java
"사실 세션은 쿠키로 구현이 되어 있다"
 
 -> **세션**은 어떤 프로세스들 사이에서 (브라우저와 웹서버) 서로를 인식한 이후, 
    통신을 마칠때 까지의 기간 정도로 이해하자.
```