## TCP/IP stack 설명

<br/>

## TCP/IP stack이란?

![이미지](/programming/img/입문560.PNG)

TCP/IP 는 4개의 layer로 구성 되어 있지만, 2개의 layer로 분류 할 수 있다.

- 주황색 부분 : application

    - 애플리케이션 레벨에서 구현 / 관리

    - 네트워크 기능을 사용하는데 목적이 있다.

- 초록색 부분 : system

    - 하드웨어 / 펌웨어, OS 레벨에서 구현/관리되는 것이다.

    - 네트워크 기능을 지원하는데 목적이 있다.

```java
"기억하기"
애플리케이션이 시스템의 기능을 함부로 쓸 순 없다.

-> 대신 시스템은 애플리케이션이 네트워크 기능을 사용할 수 있도록
   "프로그래밍 인터페이스"를 제공하는데 -> 그것을 "Socket" 이라고 한다.
   그리하여 애플리케이션은 socket을 통해 데이터를 주고 받는다.

개발자는 socket programming을 통해 네트워크 상의 
다른 프로세스와 데이터를 주고 받을 수 있도록 구현한다.
```

<br/><br/>

## TCP/IP 초창기

![이미지](/programming/img/입문561.PNG)

애플리케이션에서 프로세스가 동작 중이다.

- 만약, 프로세스가 `네트워크 통신`을 하고 싶다면?

    - 즉, 인터넷 상에서의 또 다른 프로세스와 데이터를 주고 받고 싶다면?

- 그림에서의 파란색 네모 모양처럼, 프로세스와 연결 되어서 데이터 통로 같은 느낌이다.

    - 그리하여, 애플리케이션에서 통로를 통해 system으로 데이터를 내려 주면
        
        system이 지원하는 네트워크 기능을 사용을 하여, 데이터를 인터넷 상에 있는 
        
        또 다른 프로세스에게 전달을 할 수 있게 되는 것이다
        
- 반대로 받는 경우에도 똑같이 system으로 오고 통로를 통해서 받게 되는 것이다.

```java
"process"와 연결된 "data path" 혹은 "data channel"
저 파란색 통로 역할을 하는 것을, "Port" 라고 부른다.
```

<br/><br/>

### Port

- port name을 통해 식별한다.

    - 각각의 포트 이름에 대해서 어떻게 지정할지?

        - 그것은, 각 시스템마다 다르다.

<br/><br/>

## e.g. 설명

![이미지](/programming/img/입문562.PNG)

- 서로 통신을 하고 싶다면? → 일단 `port`를 얻어야 하는 것이다.

    - 이렇게, 포트를 통해서 네트워크 통신을 하게 되는 것이다.

<br/>

### 하지만,

프로세스 간의 통신에서는 데이터를 안정적으로 주고 받을 수 있는 프로토콜이 필요하다.

- 그것이 바로 `TCP` 이다.

<br/><br/>

## TCP의 중요한 용어

![이미지](/programming/img/입문563.PNG)

- `Connection:` 프로세스 간의 안정적이고 논리적인 `통신 통로를 말한다.`

    - 커넥션은 `“연결”`이라는 의미가 있지만, `TCP에서는 그 이상의 의미를 가지고 있다.`    
    - Connection을 열고, 데이터를 주고 받고, Connection을 닫는다.

        - Connection을 열때는 → `3-way`가 발생하고, 닫을때는 `4-way`로 닫게 된다.

        - 커넥션을 열고, 데이터를 주고 받고, 닫고 하는 용어를 → connection-oriented 라고 한다.

- `Socket` : 인터넷 상에 존재하는 각 port를 유니크하게 식별하기 위한 주소이다.

    - (protocol)에 (ip 주소)에 (포트 number)를 합친 것이다. (별거 없음)

    - 각 socket은 인터넷 상에서 유니크 해야 한다. → (고유해야 한다는 것)

<br/><br/>

## Connection 과 Socket 의 관계는?

`TCP에서 각 connection은 유니크하게 식별할 수 있어야 한다.`

<br/>

### 유니크 하지 않다면?

안정적으로 데이터를 전송하기 위해서는 각 커넥션마다 따로 모든 정보를 관리해줘야 할 건데, 

지금 어떤 커넥션에 대해 처리를 하고 있는 것인지, system이 판단할 수 없다. 

<br/>

그렇기에 인터넷 상에 존재하는 모든 TCP Connection은 유니크 하게 식별할 수 있어야 하는 것이다.

<br/>

### 유니크하게 식별 하는 방법은?

`한 쌍의 socket은 connection을 유니크하게 식별할 수 있다.`

즉, `src internet addr`, `src portdest`, `dest internet addr`, `dest port` 이다.

<br/>

4개의 값을 통해서 connection을 유니크하게 식별하는 것이다.

즉, 밑에 그림 처럼 컴퓨터의(protocol)과 (IP address)와 포트에 부여된 (Port number)를 가지고, 

하나의 socket이 만들어 진다. 결국 '커넥션'이라는 것은 한쌍(양쪽)의 소켓에 의해 만들어지는 것이다.

<br/>

각각의 소켓은 인터넷 상에서 유일하기 때문에한쌍(양쪽)의 소켓으로 

커넥션을 유니크하게 식별 가능하게 되는 것이다.

![이미지](/programming/img/입문564.PNG)

`하나의 socket은 동시에 여러 connection들에서 사용될 수 있다.`

<br/>

즉, 인터넷에 있는 다른 프로세스들도 해당 프로세스로 연결이 되어야 하기 때문에

해당, 하나의 소켓은 동시에 여러 커넥션들에 사용 될 수 있다는 것이다.

<br/><br/>

## UDP란?

- connectionless : 연결을 맺지 않고, 바로 데이터를 주고 받는다

- unreliable : internet protocol을 거의 그대로 사용한다.

    - 즉, unreliable → 신뢰할 수 없는 프로토콜을 의미한다
    
        - e.g. 간단한 에러 체크 정도만 하는 것이다.