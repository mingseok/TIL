## HTTP 정보는 HTTP 메시지에 있다.

HTTP에서 교환하는 데이터는 HTTP 메시지라고 불리며, 클라이언트의 요청 메시지를 리퀘스트 메시지, 

서버의 응답 메시지를 리스폰스 메시지라고 한다.

<br/>

HTTP 메시지는 복수행으로 이루어진 텍스트이며 크게 구분하여 메시지 헤더와 메시지 바디로 이루어져 있다. 

최초에 나타난 개행 문자로 메시지 헤더와 바디를 구분한다. HTTP 메시지 안에 바디는 없을수도 있다.

<br/><br/>

## HTTP 메시지 구조

- 메시지 헤더 : 서버와 클라이언트가 꼭 처리해야하는 리퀘스트와 리스폰스 내용과 속성

- 개행문자(CR+LF) : CR(Carriage Return)은 커서를 맨 앞으로 옮겨주며, LF(Line Feed)는 줄을 바꿔준다.

- 메시지 바디 : 전송되는 데이터 그 자체

<br/>

- 리퀘스트 라인
    - 리퀘스트에 사용하는 메소드와 리퀘스트 URI와 사용하는 HTTP 버전이 포함된다.

- 상태 라인
    - 리스폰스 결과를 나타내는 상태 코드와 설명, 사용하는 HTTP 버전이 포함 된다.

- 헤더 필드
    - 리퀘스트와 리스폰스의 여러 조건과 속성 등을 나타내는 각종 헤더 필드가 포함 된다.

<br/><br/>

## 인코딩으로 전송 효율을 높이다.

인코딩을 실시함으로써 전송 효율을 높일 수 있다.

- 전송할 때 인코딩을 하면 다량의 액세스를 효율 좋게 처리 할 수 있습니다.

- 단지 컴퓨터에서 인코딩 처리를 해야 하기 때문에 CPU 등의 리소스는 보다 많이 소비 하게 된다.

<br/><br/>

## 메시지 바디와 엔티티 바디의 차이

- 메시지 : HTTP 통신의 기본 단위, 옥텟(8bit) 시퀀스로 구성되고 통신을 통해 전송된다.

- 엔티티 : 리퀘스트, 리스폰스의 페이로드로 전송되는 정보. 엔티티 헤더 필드와 엔티티 바디로 구성된다.

<br/>

HTTP 메시지 바디의 역할은 리퀘스트랑 리스폰스에 관한 엔티티 바디를 운반하는 일입니다.



기본적으로 메시지 바디와 엔티티 바디는 같지만 전송 코딩이 적용된 경우에는 

엔티티 바디의 내용이 변화하기 때문에 메시지 바디와 달라진다.

<br/><br/>

## 압축해서 보내는 콘텐츠 코딩

메일에 파일을 첨부해서 보낼 경우, 같이 용량을 줄이기 위해서 파일을 zip으로 압축하고 첨부해서 보내는 일이 있다.

HTTP에는 이와 같은 일이 ‘콘텐츠 코딩’ 이라고 불리는 기능이 구현 되어 있다.

엔티티에 적용하는 인코딩을 가리키는데, 엔티티 정보를 유지한채로 압축한다.

<br/><br/>

## 분해해서 보내는 청크 전송 코딩

리소스 전부에서 엔티티 바디의 전송이 완료되지 않으면 브라우저에 표시되지 않는다. 

사이즈가 큰 데이터를 전송하는 경우에는 데이터를 분할해서 조금씩 표시할 수 있다.

<br/>

이렇게 엔티티 바디를 분할하는 기능을 청크 전송 코딩이라고 부른다.

청크 전송 코딩은 엔티티 바디를 청크(덩어리)로 분해합니다.

<br/><br/>

## 여러 데이터를 보내는 멀티파트

메일의 경우에는 메일의 본문이나 복수의 첨부 파일을 붙여서 함께 보낼때가 있다. 

이것이 MIME으로 불리는 메일로 텍스트나 영상, 이미지와 같은 여러 다른 데이터를 다루기 위한 기능을 사용하고 있다.

<br/>

MIME는 이미지 등의 바이너리 데이터를 아스키 문자열에 인코딩하는 방법과 데이터 종류를 나타내는 방법 등을 규정하고 있다.

MIME의 확장 사양에 있는 멀티파트라고 하는 여러 다른 종류의 데이터를 수용하는 방법을 사용하고 있는 것이다.

<br/>

HTTP도 멀티파트에 대응하고 있어 하나의 메시지 바디 내부에 엔티티를 여러 개 포함 시켜 보낼 수 있다. 

주로 이미지나 텍스트 파일 등을 업로드할때 사용되고 있다.

```
HTTP/1.1 206 Partial Content
Date: Fri, 13 Jul 2012 02:45:26 GMT
Last-Modified: Fri, 31 Aug 2007 02:02:20 GMT
Content-Type: multipart/byteranges; boundary=THIS_STRING_SEPARATES

--THIS_STRING_SEPARATES
Content-Type: application/pdf
Content-Range: bytes 500-999/8000

...(지정한 범위의 데이터)...
--THIS_STRING_SEPARATES
Content-Type: application/pdf
Content-Range: bytes 7000-7999/8000
--THIS_STRING_SEPARATES--
```



멀티파트에서 각 엔티티를 구분하기 위해서 boundary 문자열을 사용한다. 

각 엔티티 앞에는 **`--`**문자 뒤에 boundary 문자열을 붙인다. 

그리고 멀티파트의 마지막은 **`--`** 문자를 boundary 문자열 앞뒤로 붙여 끝을 알린다.

<br/><br/>

## 일부분만 받는 레인지 리퀘스트

레인지 리퀘스트를 사용하면 다운로드 중 인터넷 연결이 끊겨 끝내 

다 받지 못한 데이터를 수신받지 못한 일부분만을 별도로 다운로드할 수 있다. 

<br/>

이런 기능을 리줌이라고 하며, HTTP의 레인지 리퀘스트를 사용하여 구현할 수 있다.

**`Range`**헤더를 통해 데이터의 일부분만을 수신받을 수 있다.

```
GET /tip.jpg HTTP/1.1
Host: www.usagidesign.jp
Range: bytes=5001-10000
```

<br/><br/>

## 최적의 콘텐츠를 돌려주는 콘텐츠 네고시에이션

같은 콘텐츠(내용)이지만 여러 개의 페이지를 지닌 웹 페이지가 있다.

예를 들면, 내용은 같지만 영어판과 한국어판이 있듯이 같이 표시되는 언어가 서로 다른 웹 페이지의 경우이다.

<br/>

서로 다른 언어를 주로 사용하는 브라우저가 같은 URI에 액세스할 때에 각각 영어판 웹 페이지와 한국어판 웹 페이지를 표시한다.

이와 같은 구조를 콘텐츠 네고시에이션이라고 한다.

<br/>

### 서버 구동형 네고시에이션

서버 측에서 리퀘스트 헤더 필드를 참고하여 콘텐츠 네고시에이션 하는 방식이다. 

브라우저가 보내는 정보를 기반으로 작동하기 때문에 유저에게 정말 적절한 콘텐츠가 선택되었는지 확신할 수 없다.

<br/>

### 에이전트 구동형 네고시에이션

서버 측에서 리퀘스트 헤더 필드를 참고하여 콘텐츠 네고시에이션 하는 방식이다. 

브라우저가 보내는 정보를 기반으로 작동하기 때문에 유저에게 정말 적절한 콘텐츠가 선택되었는지 확신할 수 없다.


<br/>

### 트랜스페어런트 네고시에이션

서버 구동형과 에이전트 구동형을 혼합하여 서버, 클라이언트 각각이 콘텐츠 네고시에이션을 하는 방식이다.